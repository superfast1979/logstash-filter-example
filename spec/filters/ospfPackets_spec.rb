# encoding: utf-8
require_relative '../spec_helper'
require "logstash/filters/ospfPackets"
require "json"

describe LogStash::Filters::Ospfpackets do
	
	describe Array do
	  it "should be empty when first created" do
	    expect(subject).to be_empty
	  end
	end

	describe "subject valid" do
	  subject { [1, 2, 3] }
	  it "should be setted when first created" do
	    expect(subject).to eq([1, 2, 3])
	  end
	end

    describe String do
      it "is available as described_class" do
        expect(described_class).to eq(String)
      end
    end
   
    describe LogStash::Filters::Ospfpackets do
    	subject { described_class.new(config) }
		let(:config) { Hash.new }
		let(:event) { LogStash::Event.new(data) }
		let(:data) { { "json_parsed" => message } }
		let(:message) { JSON.parse('{"timestamp":"1643721667955","layers":{"frame":{"frame_frame_encap_type":"25","frame_frame_time":"2022-02-01T13:21:07.958804000Z","frame_frame_offset_shift":"0.000000000","frame_frame_time_epoch":"1643721667.958804000","frame_frame_time_delta":"0.000000000","frame_frame_time_delta_displayed":"0.000000000","frame_frame_time_relative":"0.000000000","frame_frame_number":"1","frame_frame_len":"196","frame_frame_cap_len":"196","frame_frame_marked":false,"frame_frame_ignored":false,"frame_frame_protocols":"sll:ip:ospf"},"sll":{"sll_sll_pkttype":"0","sll_sll_hatype":"778","sll_sll_halen":"0","sll_sll_unused":"00:00:00:00:00:00:00:00","sll_sll_gretype":"0x00000800"},"ip":{"ip_ip_version":"4","ip_ip_hdr_len":"20","ip_ip_dsfield":"0x000000c0","ip_ip_dsfield_dscp":"48","ip_ip_dsfield_ecn":"0","ip_ip_len":"180","ip_ip_id":"0x00005f3e","ip_ip_flags":"0x00000000","ip_ip_flags_rb":false,"ip_ip_flags_df":false,"ip_ip_flags_mf":false,"ip_ip_frag_offset":"0","ip_ip_ttl":"1","ip_ip_proto":"89","ip_ip_checksum":"0x0000163b","ip_ip_checksum_status":"2","ip_ip_src":"177.177.177.1","ip_ip_addr":["177.177.177.1","224.0.0.5"],"ip_ip_src_host":"177.177.177.1","ip_ip_host":["177.177.177.1","224.0.0.5"],"ip_ip_dst":"224.0.0.5","ip_ip_dst_host":"224.0.0.5"},"ospf":{"ospf_ospf_header":null,"ospf_ospf_version":"2","ospf_ospf_msg":"4","ospf_ospf_msg_lsupdate":true,"ospf_ospf_packet_length":"160","ospf_ospf_srcrouter":"124.0.0.7","ospf_ospf_area_id":"0.0.0.8","ospf_ospf_checksum":"0x00006b5f","ospf_ospf_auth_type":"0","ospf_ospf_auth_none":"00:00:00:00:00:00:00:00","text":["LSA-type 1 (Router-LSA), len 132","Type: Stub     ID: 9.9.9.1         Data: 255.255.255.255 Metric: 1","Type: Stub     ID: 192.168.100.64  Data: 255.255.255.252 Metric: 10","Type: Stub     ID: 192.168.100.68  Data: 255.255.255.252 Metric: 10","Type: Stub     ID: 192.168.100.72  Data: 255.255.255.252 Metric: 10","Type: Stub     ID: 192.168.100.20  Data: 255.255.255.252 Metric: 10","Type: PTP      ID: 24.0.0.4        Data: 192.168.100.26  Metric: 65535","Type: Stub     ID: 192.168.100.24  Data: 255.255.255.252 Metric: 10","Type: PTP      ID: 124.0.0.7       Data: 192.168.100.78  Metric: 65535","Type: Stub     ID: 192.168.100.76  Data: 255.255.255.252 Metric: 10"],"ospf_ospf_ls_number_of_lsas":"1","ospf_ospf_lsa_age":"2","ospf_ospf_lsa_donotage":"0","ospf_ospf_v2_options":"0x00000028","ospf_ospf_v2_options_dn":false,"ospf_ospf_v2_options_o":false,"ospf_ospf_v2_options_dc":true,"ospf_ospf_v2_options_l":false,"ospf_ospf_v2_options_n":true,"ospf_ospf_v2_options_mc":false,"ospf_ospf_v2_options_e":false,"ospf_ospf_v2_options_mt":false,"ospf_ospf_lsa":"1","ospf_ospf_lsa_router":true,"ospf_ospf_lsa_id":"24.0.0.5","ospf_ospf_advrouter":"24.0.0.5","ospf_ospf_lsa_seqnum":"0x800004bf","ospf_ospf_lsa_chksum":"0x0000525c","ospf_ospf_lsa_length":"132","ospf_ospf_v2_router_lsa_flags":"0x00000002","ospf_ospf_v2_router_lsa_flags_h":false,"ospf_ospf_v2_router_lsa_flags_n":false,"ospf_ospf_v2_router_lsa_flags_w":false,"ospf_ospf_v2_router_lsa_flags_v":false,"ospf_ospf_v2_router_lsa_flags_e":true,"ospf_ospf_v2_router_lsa_flags_b":false,"ospf_ospf_lsa_number_of_links":"9","ospf_ospf_lsa_router_linkid":["9.9.9.1","192.168.100.64","192.168.100.68","192.168.100.72","192.168.100.20","24.0.0.4","192.168.100.24","124.0.0.7","192.168.100.76"],"ospf_ospf_lsa_router_linkdata":["255.255.255.255","255.255.255.252","255.255.255.252","255.255.255.252","255.255.255.252","192.168.100.26","255.255.255.252","192.168.100.78","255.255.255.252"],"ospf_ospf_lsa_router_linktype":["3","3","3","3","3","1","3","1","3"],"ospf_ospf_lsa_router_nummetrics":["0","0","0","0","0","0","0","0","0"],"ospf_ospf_lsa_router_metric0":["1","10","10","10","10","65535","10","65535","10"]}}}') }
		
		before(:each) do
		  subject.register
		end
	    
	    context 'drop event' do
	    	let(:message) { JSON.parse('{"timestamp":"1643721667956","layers":{"frame":{"frame_frame_encap_type":"25","frame_frame_time":"2022-02-01T13:21:07.958804000Z","frame_frame_offset_shift":"0.000000000","frame_frame_time_epoch":"1643721667.958804000","frame_frame_time_delta":"0.000000000","frame_frame_time_delta_displayed":"0.000000000","frame_frame_time_relative":"0.000000000","frame_frame_number":"1","frame_frame_len":"196","frame_frame_cap_len":"196","frame_frame_marked":false,"frame_frame_ignored":false,"frame_frame_protocols":"sll:ip:ospf"},"sll":{"sll_sll_pkttype":"0","sll_sll_hatype":"778","sll_sll_halen":"0","sll_sll_unused":"00:00:00:00:00:00:00:00","sll_sll_gretype":"0x00000800"},"ip":{"ip_ip_version":"4","ip_ip_hdr_len":"20","ip_ip_dsfield":"0x000000c0","ip_ip_dsfield_dscp":"48","ip_ip_dsfield_ecn":"0","ip_ip_len":"180","ip_ip_id":"0x00005f3e","ip_ip_flags":"0x00000000","ip_ip_flags_rb":false,"ip_ip_flags_df":false,"ip_ip_flags_mf":false,"ip_ip_frag_offset":"0","ip_ip_ttl":"1","ip_ip_proto":"89","ip_ip_checksum":"0x0000163b","ip_ip_checksum_status":"2","ip_ip_src":"177.177.177.1","ip_ip_addr":["177.177.177.1","224.0.0.5"],"ip_ip_src_host":"177.177.177.1","ip_ip_host":["177.177.177.1","224.0.0.5"],"ip_ip_dst":"224.0.0.5","ip_ip_dst_host":"224.0.0.5"},"ospf":{"ospf_ospf_header":null,"ospf_ospf_version":"2","ospf_ospf_msg":"4","ospf_ospf_msg_lsupdate":true,"ospf_ospf_packet_length":"160","ospf_ospf_srcrouter":"124.0.0.7","ospf_ospf_area_id":"0.0.0.8","ospf_ospf_checksum":"0x00006b5f","ospf_ospf_auth_type":"0","ospf_ospf_auth_none":"00:00:00:00:00:00:00:00","text":["LSA-type 1 (Router-LSA), len 132","Type: Stub     ID: 9.9.9.1         Data: 255.255.255.255 Metric: 1","Type: Stub     ID: 192.168.100.64  Data: 255.255.255.252 Metric: 10","Type: Stub     ID: 192.168.100.68  Data: 255.255.255.252 Metric: 10","Type: Stub     ID: 192.168.100.72  Data: 255.255.255.252 Metric: 10","Type: Stub     ID: 192.168.100.20  Data: 255.255.255.252 Metric: 10","Type: PTP      ID: 24.0.0.4        Data: 192.168.100.26  Metric: 65535","Type: Stub     ID: 192.168.100.24  Data: 255.255.255.252 Metric: 10","Type: PTP      ID: 124.0.0.7       Data: 192.168.100.78  Metric: 65535","Type: Stub     ID: 192.168.100.76  Data: 255.255.255.252 Metric: 10"],"ospf_ospf_ls_number_of_lsas":"0","ospf_ospf_lsa_age":"2","ospf_ospf_lsa_donotage":"0","ospf_ospf_v2_options":"0x00000028","ospf_ospf_v2_options_dn":false,"ospf_ospf_v2_options_o":false,"ospf_ospf_v2_options_dc":true,"ospf_ospf_v2_options_l":false,"ospf_ospf_v2_options_n":true,"ospf_ospf_v2_options_mc":false,"ospf_ospf_v2_options_e":false,"ospf_ospf_v2_options_mt":false,"ospf_ospf_lsa":"1","ospf_ospf_lsa_router":true,"ospf_ospf_lsa_id":"24.0.0.5","ospf_ospf_advrouter":"24.0.0.5","ospf_ospf_lsa_seqnum":"0x800004bf","ospf_ospf_lsa_chksum":"0x0000525c","ospf_ospf_lsa_length":"132","ospf_ospf_v2_router_lsa_flags":"0x00000002","ospf_ospf_v2_router_lsa_flags_h":false,"ospf_ospf_v2_router_lsa_flags_n":false,"ospf_ospf_v2_router_lsa_flags_w":false,"ospf_ospf_v2_router_lsa_flags_v":false,"ospf_ospf_v2_router_lsa_flags_e":true,"ospf_ospf_v2_router_lsa_flags_b":false,"ospf_ospf_lsa_number_of_links":"9","ospf_ospf_lsa_router_linkid":["9.9.9.1","192.168.100.64","192.168.100.68","192.168.100.72","192.168.100.20","24.0.0.4","192.168.100.24","124.0.0.7","192.168.100.76"],"ospf_ospf_lsa_router_linkdata":["255.255.255.255","255.255.255.252","255.255.255.252","255.255.255.252","255.255.255.252","192.168.100.26","255.255.255.252","192.168.100.78","255.255.255.252"],"ospf_ospf_lsa_router_linktype":["3","3","3","3","3","1","3","1","3"],"ospf_ospf_lsa_router_nummetrics":["0","0","0","0","0","0","0","0","0"],"ospf_ospf_lsa_router_metric0":["1","10","10","10","10","65535","10","65535","10"]}}}') }
	    	it "drop event if ospf_ospf_ls_number_of_lsas == 0" do
	    		subject.filter(event)
	    		expect(described_class).to eq(LogStash::Filters::Ospfpackets)
	    		expect(event).to be_cancelled
	    	end
        end
       
	    context 'drop event' do
	    	let(:message) { JSON.parse('{}') }
	    	it "drop event if ospf_ospf_ls_number_of_lsas == nil" do
	    		subject.filter(event)
	    		expect(described_class).to eq(LogStash::Filters::Ospfpackets)
	    		expect(event).to be_cancelled
	    	end
        end

	    context 'verify original event as received' do
	    	let(:message) { JSON.parse('{"timestamp":"1643723807633","layers":{"frame":{"frame_frame_encap_type":"25","frame_frame_time":"2022-02-01T13:56:47.633986000Z","frame_frame_offset_shift":"0.000000000","frame_frame_time_epoch":"1643723807.633986000","frame_frame_time_delta":"93.736344000","frame_frame_time_delta_displayed":"93.736344000","frame_frame_time_relative":"2139.675182000","frame_frame_number":"51","frame_frame_len":"100","frame_frame_cap_len":"100","frame_frame_marked":false,"frame_frame_ignored":false,"frame_frame_protocols":"sll:ip:ospf"},"sll":{"sll_sll_pkttype":"0","sll_sll_hatype":"778","sll_sll_halen":"0","sll_sll_unused":"00:00:00:00:00:00:00:00","sll_sll_gretype":"0x00000800"},"ip":{"ip_ip_version":"4","ip_ip_hdr_len":"20","ip_ip_dsfield":"0x000000c0","ip_ip_dsfield_dscp":"48","ip_ip_dsfield_ecn":"0","ip_ip_len":"84","ip_ip_id":"0x0000634c","ip_ip_flags":"0x00000000","ip_ip_flags_rb":false,"ip_ip_flags_df":false,"ip_ip_flags_mf":false,"ip_ip_frag_offset":"0","ip_ip_ttl":"1","ip_ip_proto":"89","ip_ip_checksum":"0x0000168f","ip_ip_checksum_status":"2","ip_ip_src":"175.175.175.1","ip_ip_addr":["175.175.175.1","224.0.0.5"],"ip_ip_src_host":"175.175.175.1","ip_ip_host":["175.175.175.1","224.0.0.5"],"ip_ip_dst":"224.0.0.5","ip_ip_dst_host":"224.0.0.5"},"ospf":{"ospf_ospf_header":null,"ospf_ospf_version":"2","ospf_ospf_msg":"4","ospf_ospf_msg_lsupdate":true,"ospf_ospf_packet_length":"64","ospf_ospf_srcrouter":"124.0.0.7","ospf_ospf_area_id":"0.0.0.0","ospf_ospf_checksum":"0x000050e2","ospf_ospf_auth_type":"0","ospf_ospf_auth_none":"00:00:00:00:00:00:00:00","text":"LSA-type 5 (AS-External-LSA (ASBR)), len 36","ospf_ospf_ls_number_of_lsas":"1","ospf_ospf_lsa_age":"2","ospf_ospf_lsa_donotage":"0","ospf_ospf_v2_options":"0x00000020","ospf_ospf_v2_options_dn":false,"ospf_ospf_v2_options_o":false,"ospf_ospf_v2_options_dc":true,"ospf_ospf_v2_options_l":false,"ospf_ospf_v2_options_n":false,"ospf_ospf_v2_options_mc":false,"ospf_ospf_v2_options_e":false,"ospf_ospf_v2_options_mt":false,"ospf_ospf_lsa":"5","ospf_ospf_lsa_asext":true,"ospf_ospf_lsa_id":"24.0.0.174","ospf_ospf_advrouter":"12.0.0.18","ospf_ospf_lsa_seqnum":"0x80000138","ospf_ospf_lsa_chksum":"0x0000f541","ospf_ospf_lsa_length":"36","ospf_ospf_lsa_asext_netmask":"255.255.255.255","ospf_ospf_lsa_asext_type":true,"ospf_ospf_lsa_tos":"0","ospf_ospf_metric":"20","ospf_ospf_lsa_asext_fwdaddr":"192.168.52.174","ospf_ospf_lsa_asext_extrttag":"0"}}}') }
	    	it "event equal to original" do
	    		events = [event]
	    		subject.filter(event) {|e| events << e }
	    		expect(events.length).to eq(2)
	    		expect(events[0]).to eq(event)
	    		expect(events[0].get("[json_parsed][layers][ospf][ospf_ospf_ls_number_of_lsas]")).to eq("1")
	    		# add more fields to test better
	    	end
        end

	    context 'verify fields removed in cloned message' do
	    	let(:message) { JSON.parse('{"timestamp":"1643723807633","layers":{"frame":{"frame_frame_encap_type":"25","frame_frame_time":"2022-02-01T13:56:47.633986000Z","frame_frame_offset_shift":"0.000000000","frame_frame_time_epoch":"1643723807.633986000","frame_frame_time_delta":"93.736344000","frame_frame_time_delta_displayed":"93.736344000","frame_frame_time_relative":"2139.675182000","frame_frame_number":"51","frame_frame_len":"100","frame_frame_cap_len":"100","frame_frame_marked":false,"frame_frame_ignored":false,"frame_frame_protocols":"sll:ip:ospf"},"sll":{"sll_sll_pkttype":"0","sll_sll_hatype":"778","sll_sll_halen":"0","sll_sll_unused":"00:00:00:00:00:00:00:00","sll_sll_gretype":"0x00000800"},"ip":{"ip_ip_version":"4","ip_ip_hdr_len":"20","ip_ip_dsfield":"0x000000c0","ip_ip_dsfield_dscp":"48","ip_ip_dsfield_ecn":"0","ip_ip_len":"84","ip_ip_id":"0x0000634c","ip_ip_flags":"0x00000000","ip_ip_flags_rb":false,"ip_ip_flags_df":false,"ip_ip_flags_mf":false,"ip_ip_frag_offset":"0","ip_ip_ttl":"1","ip_ip_proto":"89","ip_ip_checksum":"0x0000168f","ip_ip_checksum_status":"2","ip_ip_src":"175.175.175.1","ip_ip_addr":["175.175.175.1","224.0.0.5"],"ip_ip_src_host":"175.175.175.1","ip_ip_host":["175.175.175.1","224.0.0.5"],"ip_ip_dst":"224.0.0.5","ip_ip_dst_host":"224.0.0.5"},"ospf":{"ospf_ospf_header":null,"ospf_ospf_version":"2","ospf_ospf_msg":"4","ospf_ospf_msg_lsupdate":true,"ospf_ospf_packet_length":"64","ospf_ospf_srcrouter":"124.0.0.7","ospf_ospf_area_id":"0.0.0.0","ospf_ospf_checksum":"0x000050e2","ospf_ospf_auth_type":"0","ospf_ospf_auth_none":"00:00:00:00:00:00:00:00","text":"LSA-type 5 (AS-External-LSA (ASBR)), len 36","ospf_ospf_ls_number_of_lsas":"1","ospf_ospf_lsa_age":"2","ospf_ospf_lsa_donotage":"0","ospf_ospf_v2_options":"0x00000020","ospf_ospf_v2_options_dn":false,"ospf_ospf_v2_options_o":false,"ospf_ospf_v2_options_dc":true,"ospf_ospf_v2_options_l":false,"ospf_ospf_v2_options_n":false,"ospf_ospf_v2_options_mc":false,"ospf_ospf_v2_options_e":false,"ospf_ospf_v2_options_mt":false,"ospf_ospf_lsa":"5","ospf_ospf_lsa_asext":true,"ospf_ospf_lsa_id":"24.0.0.174","ospf_ospf_advrouter":"12.0.0.18","ospf_ospf_lsa_seqnum":"0x80000138","ospf_ospf_lsa_chksum":"0x0000f541","ospf_ospf_lsa_length":"36","ospf_ospf_lsa_asext_netmask":"255.255.255.255","ospf_ospf_lsa_asext_type":true,"ospf_ospf_lsa_tos":"0","ospf_ospf_metric":"20","ospf_ospf_lsa_asext_fwdaddr":"192.168.52.174","ospf_ospf_lsa_asext_extrttag":"0"}}}') }
	    	it "no more specific fields in cloned event" do
	            events = [event]
                subject.filter(event) {|e| events << e }
                expect(events.length).to eq(2)
	    		expect(events[1].get("[json_parsed][layers][sll]")).to eq(nil)
	    		expect(events[1].get("[json_parsed][layers][ip]")).to eq(nil)
	    		expect(events[1].get("[json_parsed][layers][frame]")).to eq(nil)
	    		expect(events[1].get("[json_parsed][layers][ospf][ospf_ospf_header]")).to eq(nil)
	    		expect(events[1].get("[json_parsed][layers][ospf][ospf_ospf_version]")).to eq(nil)
	    		expect(events[1].get("[json_parsed][layers][ospf][ospf_ospf_msg]")).to eq(nil)
	    		expect(events[1].get("[json_parsed][layers][ospf][ospf_ospf_msg_lsupdate]")).to eq(nil)
	    		expect(events[1].get("[json_parsed][layers][ospf][ospf_ospf_packet_length]")).to eq(nil)
	    		expect(events[1].get("[json_parsed][layers][ospf][ospf_ospf_checksum]")).to eq(nil)
	    		expect(events[1].get("[json_parsed][layers][ospf][ospf_ospf_auth_type]")).to eq(nil)
	    		expect(events[1].get("[json_parsed][layers][ospf][ospf_ospf_auth_none]")).to eq(nil)
	    		expect(events[1].get("[json_parsed][layers][ospf][text]")).to eq(nil)
	    		expect(events[1].get("[json_parsed][layers][ospf][ospf_ospf_ls_number_of_lsas]")).to eq(nil)
	    		expect(events[1].get("[json_parsed][layers][ospf][ospf_ospf_v2_options]")).to eq(nil)
	    		expect(events[1].get("[json_parsed][layers][ospf][ospf_ospf_v2_options_o]")).to eq(nil)
	    		expect(events[1].get("[json_parsed][layers][ospf][ospf_ospf_v2_options_dc]")).to eq(nil)
	    		expect(events[1].get("[json_parsed][layers][ospf][ospf_ospf_v2_options_l]")).to eq(nil)
	    		expect(events[1].get("[json_parsed][layers][ospf][ospf_ospf_v2_options_n]")).to eq(nil)
	    		expect(events[1].get("[json_parsed][layers][ospf][ospf_ospf_v2_options_mc]")).to eq(nil)
	    		expect(events[1].get("[json_parsed][layers][ospf][ospf_ospf_v2_options_mt]")).to eq(nil)
	    		expect(events[1].get("[json_parsed][layers][ospf][ospf_ospf_lsa_summary]")).to eq(nil)
	    		expect(events[1].get("[json_parsed][layers][ospf][ospf_ospf_lsa_chksum]")).to eq(nil)
	    		expect(events[1].get("[json_parsed][layers][ospf][ospf_ospf_lsa_length]")).to eq(nil)
	    		expect(events[1].get("[json_parsed][layers][ospf][ospf_ospf_lsa_router]")).to eq(nil)
	    		expect(events[1].get("[json_parsed][layers][ospf][ospf_ospf_lsa_tos]")).to eq(nil)
	    		expect(events[1].get("[json_parsed][layers][ospf][ospf_ospf_lsa_asext]")).to eq(nil)
	    		expect(events[1].get("[json_parsed][layers][ospf][ospf_ospf_lsa_nssa]")).to eq(nil)
	    		expect(events[1].get("[json_parsed][layers][ospf][ospf_ospf_lsa_opaque]")).to eq(nil)
	    		expect(events[1].get("[json_parsed][layers][ospf][ospf_ospf_v2_router_lsa_flags]")).to eq(nil)
	    		expect(events[1].get("[json_parsed][layers][ospf][ospf_ospf_v2_router_lsa_flags_h]")).to eq(nil)
	    		expect(events[1].get("[json_parsed][layers][ospf][ospf_ospf_v2_router_lsa_flags_n]")).to eq(nil)
	    		expect(events[1].get("[json_parsed][layers][ospf][ospf_ospf_v2_router_lsa_flags_w]")).to eq(nil)
	    		expect(events[1].get("[json_parsed][layers][ospf][ospf_ospf_v2_router_lsa_flags_v]")).to eq(nil)
	    		expect(events[1].get("[json_parsed][layers][ospf][ospf_ospf_v2_router_lsa_flags_e]")).to eq(nil)
	    		expect(events[1].get("[json_parsed][layers][ospf][ospf_ospf_v2_router_lsa_flags_b]")).to eq(nil)
	    		expect(events[1].get("[json_parsed][layers][ospf][ospf_ospf_lsa_router_nummetrics]")).to eq(nil)
	    		expect(events[1].get("[json_parsed][layers][ospf][ospf_ospf_lsid_te_lsa_reserved]")).to eq(nil)
	    		expect(events[1].get("[json_parsed][layers][ospf][ospf_ospf_lsid_te_lsa_instance]")).to eq(nil)
	    		expect(events[1].get("[json_parsed][layers][ospf][ospf_ospf_tlv_type]")).to eq(nil)
	    		expect(events[1].get("[json_parsed][layers][ospf][ospf_ospf_tlv_length]")).to eq(nil)
	    		expect(events[1].get("[json_parsed][layers][ospf][ospf_ospf_mpls_remote_addr]")).to eq(nil)
	    		expect(events[1].get("[json_parsed][layers][ospf][ospf_ospf_mpls_link_max_bw]")).to eq(nil)
	    		expect(events[1].get("[json_parsed][layers][ospf][ospf_ospf_mpls_pri]")).to eq(nil)
	    		expect(events[1].get("[json_parsed][layers][ospf][ospf_ospf_ls_number_of_lsas]")).to eq(nil)
	    		expect(events[1].get("[json_parsed][layers][ospf][ospf_ospf_v2_options_dn]")).to eq(nil)
	    		expect(events[1].get("[json_parsed][layers][ospf][ospf_ospf_v2_options_e]")).to eq(nil)
	    		expect(events[1].get("[json_parsed][layers][ospf][ospf_ospf_lsa_donotage]")).to eq(nil)
	    		expect(events[1].get("[json_parsed][layers][ospf][ospf_ospf_lsa_asext_fwdaddr]")).to eq(nil)
	    		expect(events[1].get("[json_parsed][layers][ospf][ospf_ospf_lsa_asext_extrttag]")).to eq(nil)
	    	end
        end
              	    
	    context 'SINGLE LSA TYPE 3' do
	    	let(:message) { JSON.parse('{"timestamp":"1643722500612","layers":{"frame":{"frame_frame_encap_type":"25","frame_frame_time":"2022-02-01T13:35:00.612803000Z","frame_frame_offset_shift":"0.000000000","frame_frame_time_epoch":"1643722500.612803000","frame_frame_time_delta":"0.001447000","frame_frame_time_delta_displayed":"0.001447000","frame_frame_time_relative":"832.653999000","frame_frame_number":"17","frame_frame_len":"92","frame_frame_cap_len":"92","frame_frame_marked":false,"frame_frame_ignored":false,"frame_frame_protocols":"sll:ip:ospf"},"sll":{"sll_sll_pkttype":"0","sll_sll_hatype":"778","sll_sll_halen":"0","sll_sll_unused":"00:00:00:00:00:00:00:00","sll_sll_gretype":"0x00000800"},"ip":{"ip_ip_version":"4","ip_ip_hdr_len":"20","ip_ip_dsfield":"0x000000c0","ip_ip_dsfield_dscp":"48","ip_ip_dsfield_ecn":"0","ip_ip_len":"76","ip_ip_id":"0x00006077","ip_ip_flags":"0x00000000","ip_ip_flags_rb":false,"ip_ip_flags_df":false,"ip_ip_flags_mf":false,"ip_ip_frag_offset":"0","ip_ip_ttl":"1","ip_ip_proto":"89","ip_ip_checksum":"0x0000196c","ip_ip_checksum_status":"2","ip_ip_src":"175.175.175.1","ip_ip_addr":["175.175.175.1","224.0.0.5"],"ip_ip_src_host":"175.175.175.1","ip_ip_host":["175.175.175.1","224.0.0.5"],"ip_ip_dst":"224.0.0.5","ip_ip_dst_host":"224.0.0.5"},"ospf":{"ospf_ospf_header":null,"ospf_ospf_version":"2","ospf_ospf_msg":"4","ospf_ospf_msg_lsupdate":true,"ospf_ospf_packet_length":"56","ospf_ospf_srcrouter":"124.0.0.7","ospf_ospf_area_id":"0.0.0.0","ospf_ospf_checksum":"0x000061da","ospf_ospf_auth_type":"0","ospf_ospf_auth_none":"00:00:00:00:00:00:00:00","text":"LSA-type 3 (Summary-LSA (IP network)), len 28","ospf_ospf_ls_number_of_lsas":"1","ospf_ospf_lsa_age":"1","ospf_ospf_lsa_donotage":"0","ospf_ospf_v2_options":"0x00000022","ospf_ospf_v2_options_dn":false,"ospf_ospf_v2_options_o":false,"ospf_ospf_v2_options_dc":true,"ospf_ospf_v2_options_l":false,"ospf_ospf_v2_options_n":false,"ospf_ospf_v2_options_mc":false,"ospf_ospf_v2_options_e":true,"ospf_ospf_v2_options_mt":false,"ospf_ospf_lsa":"3","ospf_ospf_lsa_summary":true,"ospf_ospf_lsa_id":"177.177.177.0","ospf_ospf_advrouter":"124.0.0.7","ospf_ospf_lsa_seqnum":"0x800000a9","ospf_ospf_lsa_chksum":"0x00009e60","ospf_ospf_lsa_length":"28","ospf_ospf_lsa_asbr_netmask":"255.255.255.252","ospf_ospf_lsa_tos":"0","ospf_ospf_metric":"65535"}}}') }
	    	it "clone one event type 3" do
	            events = [event]
                subject.filter(event) {|e| events << e }
                expect(events.length).to eq(2)
	    		expect(events[1].get("[ospf][timestamp]")).to eq(events[0].get("[json_parsed][layers][frame][frame_frame_time_epoch]"))
	    		expect(events[1].get("[ospf][lsa_type]")).to eq(events[0].get("[json_parsed][layers][ospf][ospf_ospf_lsa]"))
	    		expect(events[1].get("[ospf][lsa_age]")).to eq(events[0].get("[json_parsed][layers][ospf][ospf_ospf_lsa_age]"))
	    		expect(events[1].get("[ospf][lsa_seqnum]")).to eq(2147483817)
	    		expect(events[1].get("[ospf][lsu_pointer]")).to eq("1643722500.612803000-0-124.0.0.7")
	    		expect(events[1].get("[ospf][adv_router]")).to eq(events[0].get("[json_parsed][layers][ospf][ospf_ospf_advrouter]"))
	    		expect(events[1].get("[ospf][prefix-id]")).to eq(events[0].get("[json_parsed][layers][ospf][ospf_ospf_lsa_id]"))
	    		expect(events[1].get("[ospf][netmask]")).to eq(events[0].get("[json_parsed][layers][ospf][ospf_ospf_lsa_asbr_netmask]"))
	    		expect(events[1].get("[ospf][ospf_metric]")).to eq(events[0].get("[json_parsed][layers][ospf][ospf_ospf_metric]"))
	    		expect(events[1].get("[ospf][lsa_down_bit]")).to eq(events[0].get("[json_parsed][layers][ospf][ospf_ospf_v2_options_dn]"))
	    		expect(events[1].get("[ospf][lsa_external_bit]")).to eq(events[0].get("[json_parsed][layers][ospf][ospf_ospf_v2_options_e]"))
	    		expect(events[1].get("[ospf][area_id]")).to eq(0)
	    		expect(events[1].get("[ospf][utc_time]")).to eq(events[0].get("[json_parsed][layers][frame][frame_frame_time]"))
	    		expect(events[1].get("[ospf][extra]")).to eq("")
	    		# not expected fields
	    		expect(events[1].get("[ospf][link_type]")).to eq(nil)
	    		expect(events[1].get("[ospf][prefix_ip_fwdaddr]")).to eq(nil)
	    		expect(events[1].get("[ospf][ospf_external_tag]")).to eq(nil)
	    		expect(events[1].get("[ospf][lsa_propagate_bit]")).to eq(nil)
	    		expect(events[1].get("[ospf][lsa_opaque_type]")).to eq(nil)
	    		expect(events[1].get("[ospf][te_metric]")).to eq(nil)
	    		expect(events[1].get("[ospf][mpls_linkcolor]")).to eq(nil)
	    		expect(events[1].get("[ospf][metric_type]")).to eq(nil)
	    		expect(events[1].get("[ospf][link-id]")).to eq(nil)
	    	end
        end

	    context 'FIVE LSA TYPE 3' do
	    	let(:message) { JSON.parse('{"timestamp":"1643722500713","layers":{"frame":{"frame_frame_encap_type":"25","frame_frame_time":"2022-02-01T13:35:00.713025000Z","frame_frame_offset_shift":"0.000000000","frame_frame_time_epoch":"1643722500.713025000","frame_frame_time_delta":"0.001653000","frame_frame_time_delta_displayed":"0.001653000","frame_frame_time_relative":"832.754221000","frame_frame_number":"23","frame_frame_len":"204","frame_frame_cap_len":"204","frame_frame_marked":false,"frame_frame_ignored":false,"frame_frame_protocols":"sll:ip:ospf"},"sll":{"sll_sll_pkttype":"0","sll_sll_hatype":"778","sll_sll_halen":"0","sll_sll_unused":"00:00:00:00:00:00:00:00","sll_sll_gretype":"0x00000800"},"ip":{"ip_ip_version":"4","ip_ip_hdr_len":"20","ip_ip_dsfield":"0x000000c0","ip_ip_dsfield_dscp":"48","ip_ip_dsfield_ecn":"0","ip_ip_len":"188","ip_ip_id":"0x00006081","ip_ip_flags":"0x00000000","ip_ip_flags_rb":false,"ip_ip_flags_df":false,"ip_ip_flags_mf":false,"ip_ip_frag_offset":"0","ip_ip_ttl":"1","ip_ip_proto":"89","ip_ip_checksum":"0x000014f0","ip_ip_checksum_status":"2","ip_ip_src":"177.177.177.1","ip_ip_addr":["177.177.177.1","224.0.0.5"],"ip_ip_src_host":"177.177.177.1","ip_ip_host":["177.177.177.1","224.0.0.5"],"ip_ip_dst":"224.0.0.5","ip_ip_dst_host":"224.0.0.5"},"ospf":{"ospf_ospf_header":null,"ospf_ospf_version":"2","ospf_ospf_msg":"4","ospf_ospf_msg_lsupdate":true,"ospf_ospf_packet_length":"168","ospf_ospf_srcrouter":"124.0.0.7","ospf_ospf_area_id":"0.0.0.8","ospf_ospf_checksum":"0x00008536","ospf_ospf_auth_type":"0","ospf_ospf_auth_none":"00:00:00:00:00:00:00:00","text":["LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28"],"ospf_ospf_ls_number_of_lsas":"5","ospf_ospf_lsa_age":["1","1","1","1","1"],"ospf_ospf_lsa_donotage":["0","0","0","0","0"],"ospf_ospf_v2_options":["0x00000028","0x00000028","0x00000028","0x00000028","0x00000028"],"ospf_ospf_v2_options_dn":[false,false,false,false,false],"ospf_ospf_v2_options_o":[false,false,false,false,false],"ospf_ospf_v2_options_dc":[true,true,true,true,true],"ospf_ospf_v2_options_l":[false,false,false,false,false],"ospf_ospf_v2_options_n":[true,true,true,true,true],"ospf_ospf_v2_options_mc":[false,false,false,false,false],"ospf_ospf_v2_options_e":[false,false,false,false,false],"ospf_ospf_v2_options_mt":[false,false,false,false,false],"ospf_ospf_lsa":["3","3","3","3","3"],"ospf_ospf_lsa_summary":[true,true,true,true,true],"ospf_ospf_lsa_id":["12.0.0.5","172.16.12.5","172.16.30.5","172.16.40.5","172.17.12.5"],"ospf_ospf_advrouter":["124.0.0.7","124.0.0.7","124.0.0.7","124.0.0.7","124.0.0.7"],"ospf_ospf_lsa_seqnum":["0x800000d6","0x800000d6","0x800000d6","0x800000d6","0x800000d6"],"ospf_ospf_lsa_chksum":["0x0000614c","0x0000f3fc","0x00002db1","0x0000be16","0x0000e708"],"ospf_ospf_lsa_length":["28","28","28","28","28"],"ospf_ospf_lsa_asbr_netmask":["255.255.255.255","255.255.255.255","255.255.255.255","255.255.255.255","255.255.255.255"],"ospf_ospf_lsa_tos":["0","0","0","0","0"],"ospf_ospf_metric":["31","31","31","31","31"]}}}') }
	    	it "clone five events type 3" do
	            events = [event]
                subject.filter(event) {|e| events << e }
                expect(events.length).to eq(6)
                (1..events.length-1).each do |n|
				    check_type_3(events, n, n-1)
				end    		
	    	end
        end
       
	    context 'SINGLE LSA TYPE 5' do
	    	let(:message) { JSON.parse('{"timestamp":"1643723807633","layers":{"frame":{"frame_frame_encap_type":"25","frame_frame_time":"2022-02-01T13:56:47.633986000Z","frame_frame_offset_shift":"0.000000000","frame_frame_time_epoch":"1643723807.633986000","frame_frame_time_delta":"93.736344000","frame_frame_time_delta_displayed":"93.736344000","frame_frame_time_relative":"2139.675182000","frame_frame_number":"51","frame_frame_len":"100","frame_frame_cap_len":"100","frame_frame_marked":false,"frame_frame_ignored":false,"frame_frame_protocols":"sll:ip:ospf"},"sll":{"sll_sll_pkttype":"0","sll_sll_hatype":"778","sll_sll_halen":"0","sll_sll_unused":"00:00:00:00:00:00:00:00","sll_sll_gretype":"0x00000800"},"ip":{"ip_ip_version":"4","ip_ip_hdr_len":"20","ip_ip_dsfield":"0x000000c0","ip_ip_dsfield_dscp":"48","ip_ip_dsfield_ecn":"0","ip_ip_len":"84","ip_ip_id":"0x0000634c","ip_ip_flags":"0x00000000","ip_ip_flags_rb":false,"ip_ip_flags_df":false,"ip_ip_flags_mf":false,"ip_ip_frag_offset":"0","ip_ip_ttl":"1","ip_ip_proto":"89","ip_ip_checksum":"0x0000168f","ip_ip_checksum_status":"2","ip_ip_src":"175.175.175.1","ip_ip_addr":["175.175.175.1","224.0.0.5"],"ip_ip_src_host":"175.175.175.1","ip_ip_host":["175.175.175.1","224.0.0.5"],"ip_ip_dst":"224.0.0.5","ip_ip_dst_host":"224.0.0.5"},"ospf":{"ospf_ospf_header":null,"ospf_ospf_version":"2","ospf_ospf_msg":"4","ospf_ospf_msg_lsupdate":true,"ospf_ospf_packet_length":"64","ospf_ospf_srcrouter":"124.0.0.7","ospf_ospf_area_id":"0.0.0.8","ospf_ospf_checksum":"0x000050e2","ospf_ospf_auth_type":"0","ospf_ospf_auth_none":"00:00:00:00:00:00:00:00","text":"LSA-type 5 (AS-External-LSA (ASBR)), len 36","ospf_ospf_ls_number_of_lsas":"1","ospf_ospf_lsa_age":"2","ospf_ospf_lsa_donotage":"0","ospf_ospf_v2_options":"0x00000020","ospf_ospf_v2_options_dn":false,"ospf_ospf_v2_options_o":false,"ospf_ospf_v2_options_dc":true,"ospf_ospf_v2_options_l":false,"ospf_ospf_v2_options_n":false,"ospf_ospf_v2_options_mc":false,"ospf_ospf_v2_options_e":false,"ospf_ospf_v2_options_mt":false,"ospf_ospf_lsa":"5","ospf_ospf_lsa_asext":true,"ospf_ospf_lsa_id":"24.0.0.174","ospf_ospf_advrouter":"12.0.0.18","ospf_ospf_lsa_seqnum":"0x80000138","ospf_ospf_lsa_chksum":"0x0000f541","ospf_ospf_lsa_length":"36","ospf_ospf_lsa_asext_netmask":"255.255.255.255","ospf_ospf_lsa_asext_type":true,"ospf_ospf_lsa_tos":"0","ospf_ospf_metric":"20","ospf_ospf_lsa_asext_fwdaddr":"192.168.52.174","ospf_ospf_lsa_asext_extrttag":"0"}}}') }
	    	it "clone one event type 5" do
	            events = [event]
                subject.filter(event) {|e| events << e }
                expect(events.length).to eq(2)
	    		expect(events[1].get("[ospf][timestamp]")).to eq(events[0].get("[json_parsed][layers][frame][frame_frame_time_epoch]"))
	    		expect(events[1].get("[ospf][lsa_type]")).to eq(events[0].get("[json_parsed][layers][ospf][ospf_ospf_lsa]"))
	    		expect(events[1].get("[ospf][lsa_age]")).to eq(events[0].get("[json_parsed][layers][ospf][ospf_ospf_lsa_age]"))
	    		expect(events[1].get("[ospf][lsa_seqnum]")).to eq(2147483960)
	    		expect(events[1].get("[ospf][lsu_pointer]")).to eq("1643723807.633986000-8-124.0.0.7")
	    		expect(events[1].get("[ospf][adv_router]")).to eq(events[0].get("[json_parsed][layers][ospf][ospf_ospf_advrouter]"))
	    		expect(events[1].get("[ospf][prefix-id]")).to eq(events[0].get("[json_parsed][layers][ospf][ospf_ospf_lsa_id]"))
	    		expect(events[1].get("[ospf][netmask]")).to eq(events[0].get("[json_parsed][layers][ospf][ospf_ospf_lsa_asext_netmask]"))
	    		expect(events[1].get("[ospf][ospf_metric]")).to eq(events[0].get("[json_parsed][layers][ospf][ospf_ospf_metric]"))
	    		expect(events[1].get("[ospf][prefix_ip_fwdaddr]")).to eq(events[0].get("[json_parsed][layers][ospf][ospf_ospf_lsa_asext_fwdaddr]"))
	    		expect(events[1].get("[ospf][ospf_external_tag]")).to eq(events[0].get("[json_parsed][layers][ospf][ospf_ospf_lsa_asext_extrttag]"))
	    		expect(events[1].get("[ospf][lsa_down_bit]")).to eq(events[0].get("[json_parsed][layers][ospf][ospf_ospf_v2_options_dn]"))
	    		expect(events[1].get("[ospf][lsa_external_bit]")).to eq(events[0].get("[json_parsed][layers][ospf][ospf_ospf_v2_options_e]"))
	    		expect(events[1].get("[ospf][metric_type]")).to eq(events[0].get("[json_parsed][layers][ospf][ospf_ospf_lsa_asext_type]"))
	    		expect(events[1].get("[ospf][area_id]")).to eq(8)
	    		expect(events[1].get("[ospf][utc_time]")).to eq(events[0].get("[json_parsed][layers][frame][frame_frame_time]"))
	    		expect(events[1].get("[ospf][timestamp]")).to eq(events[0].get("[json_parsed][layers][frame][frame_frame_time_epoch]"))
	    		expect(events[1].get("[ospf][extra]")).to eq("")
	    		# not expected fields
	    		expect(events[1].get("[ospf][link_type]")).to eq(nil)
	    		expect(events[1].get("[ospf][lsa_propagate_bit]")).to eq(nil)
	    		expect(events[1].get("[ospf][lsa_opaque_type]")).to eq(nil)
	    		expect(events[1].get("[ospf][te_metric]")).to eq(nil)
	    		expect(events[1].get("[ospf][mpls_linkcolor]")).to eq(nil)
	    		expect(events[1].get("[ospf][link-id]")).to eq(nil)
	    	end
        end
       
	    context 'MIX LSA WITH 2 TYPE 5' do
	    	let(:message) { JSON.parse('{"timestamp":"1644240641056","layers":{"frame":{"frame_frame_encap_type":"25","frame_frame_time":"2022-02-07T13:30:41.56923000Z","frame_frame_offset_shift":"0.000000000","frame_frame_time_epoch":"1644240641.056923000","frame_frame_time_delta":"0.026033000","frame_frame_time_delta_displayed":"0.026033000","frame_frame_time_relative":"971.669899000","frame_frame_number":"32","frame_frame_len":"528","frame_frame_cap_len":"528","frame_frame_marked":false,"frame_frame_ignored":false,"frame_frame_protocols":"sll:ip:ospf"},"sll":{"sll_sll_pkttype":"0","sll_sll_hatype":"778","sll_sll_halen":"0","sll_sll_unused":"00:00:00:00:00:00:00:00","sll_sll_gretype":"0x00000800"},"ip":{"ip_ip_version":"4","ip_ip_hdr_len":"20","ip_ip_dsfield":"0x000000c0","ip_ip_dsfield_dscp":"48","ip_ip_dsfield_ecn":"0","ip_ip_len":"512","ip_ip_id":"0x0000b8cd","ip_ip_flags":"0x00000000","ip_ip_flags_rb":false,"ip_ip_flags_df":false,"ip_ip_flags_mf":false,"ip_ip_frag_offset":"0","ip_ip_ttl":"1","ip_ip_proto":"89","ip_ip_checksum":"0x0000bf61","ip_ip_checksum_status":"2","ip_ip_src":"175.175.175.1","ip_ip_addr":["175.175.175.1","224.0.0.5"],"ip_ip_src_host":"175.175.175.1","ip_ip_host":["175.175.175.1","224.0.0.5"],"ip_ip_dst":"224.0.0.5","ip_ip_dst_host":"224.0.0.5"},"ospf":{"ospf_ospf_header":null,"ospf_ospf_version":"2","ospf_ospf_msg":"4","ospf_ospf_msg_lsupdate":true,"ospf_ospf_packet_length":"492","ospf_ospf_srcrouter":"124.0.0.7","ospf_ospf_area_id":"0.0.0.0","ospf_ospf_checksum":"0x00004711","ospf_ospf_auth_type":"0","ospf_ospf_auth_none":"00:00:00:00:00:00:00:00","text":["LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 5 (AS-External-LSA (ASBR)), len 36","LSA-type 5 (AS-External-LSA (ASBR)), len 36"],"ospf_ospf_ls_number_of_lsas":"16","ospf_ospf_lsa_age":["2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2"],"ospf_ospf_lsa_donotage":["0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"ospf_ospf_v2_options":["0x00000022","0x00000022","0x00000022","0x00000022","0x00000022","0x00000022","0x00000022","0x00000022","0x00000022","0x00000022","0x00000022","0x00000022","0x00000022","0x00000022","0x00000020","0x00000020"],"ospf_ospf_v2_options_dn":[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false],"ospf_ospf_v2_options_o":[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false],"ospf_ospf_v2_options_dc":[true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true],"ospf_ospf_v2_options_l":[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false],"ospf_ospf_v2_options_n":[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false],"ospf_ospf_v2_options_mc":[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false],"ospf_ospf_v2_options_e":[true,true,true,true,true,true,true,true,true,true,true,true,true,true,false,false],"ospf_ospf_v2_options_mt":[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false],"ospf_ospf_lsa":["3","3","3","3","3","3","3","3","3","3","3","3","3","3","5","5"],"ospf_ospf_lsa_summary":[true,true,true,true,true,true,true,true,true,true,true,true,true,true],"ospf_ospf_lsa_id":["192.168.50.137","192.168.50.216","192.168.50.88","192.168.50.24","172.17.12.2","172.16.12.2","12.0.0.2","192.168.50.68","192.168.50.12","192.168.50.128","192.168.50.124","192.168.50.184","192.168.50.164","192.168.50.144","12.0.0.100","138.132.0.0"],"ospf_ospf_advrouter":["12.0.0.18","12.0.0.18","12.0.0.18","12.0.0.18","12.0.0.18","12.0.0.18","12.0.0.18","12.0.0.18","12.0.0.18","12.0.0.18","12.0.0.18","12.0.0.18","12.0.0.18","12.0.0.18","12.0.0.18","12.0.0.18"],"ospf_ospf_lsa_seqnum":["0x800001ad","0x800001ad","0x800001ac","0x80000201","0x800005ea","0x800005ea","0x800005ea","0x8000020b","0x8000020b","0x800000db","0x800000db","0x800000b3","0x80000384","0x8000007e","0x800004b7","0x800005e3"],"ospf_ospf_lsa_chksum":["0x00000b10","0x0000e5e7","0x0000bfad","0x000096c1","0x000076d8","0x000082cd","0x0000ef1d","0x0000c859","0x0000fa5f","0x0000fff8","0x000028d4","0x00001eca","0x000048de","0x00001a2c","0x00005431","0x0000fa90"],"ospf_ospf_lsa_length":["28","28","28","28","28","28","28","28","28","28","28","28","28","28","36","36"],"ospf_ospf_lsa_asbr_netmask":["255.255.255.254","255.255.255.252","255.255.255.252","255.255.255.252","255.255.255.255","255.255.255.255","255.255.255.255","255.255.255.252","255.255.255.252","255.255.255.252","255.255.255.252","255.255.255.252","255.255.255.254","255.255.255.252"],"ospf_ospf_lsa_tos":["0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"ospf_ospf_metric":["50","50","20","20","21","21","21","20","20","50","50","50","50","50","20","20"],"ospf_ospf_lsa_asext":[true,true],"ospf_ospf_lsa_asext_netmask":["255.255.255.255","255.255.0.0"],"ospf_ospf_lsa_asext_type":[true,true],"ospf_ospf_lsa_asext_fwdaddr":["172.16.12.9","0.0.0.0"],"ospf_ospf_lsa_asext_extrttag":["0","0"]}}}') }
	    	it "clone multiple events and check only last two packets with type 5" do
	            events = [event]
                subject.filter(event) {|e| events << e }
                expect(events.length).to eq(17)
	    		expect(events[15].get("[ospf][timestamp]")).to eq("1644240641.056923000")
	    		expect(events[16].get("[ospf][timestamp]")).to eq("1644240641.056923000")
	    		expect(events[15].get("[ospf][lsa_type]")).to eq("5")
	    		expect(events[16].get("[ospf][lsa_type]")).to eq("5")
	    		expect(events[15].get("[ospf][lsa_age]")).to eq("2")
	    		expect(events[16].get("[ospf][lsa_age]")).to eq("2")
	    		expect(events[15].get("[ospf][lsa_seqnum]")).to eq(2147484855)
	    		expect(events[16].get("[ospf][lsa_seqnum]")).to eq(2147485155)
	    		expect(events[15].get("[ospf][lsu_pointer]")).to eq("1644240641.056923000-0-124.0.0.7")
	    		expect(events[16].get("[ospf][lsu_pointer]")).to eq("1644240641.056923000-0-124.0.0.7")
	    		expect(events[15].get("[ospf][adv_router]")).to eq("12.0.0.18")
	    		expect(events[16].get("[ospf][adv_router]")).to eq("12.0.0.18")
	    		expect(events[15].get("[ospf][prefix-id]")).to eq("12.0.0.100")
	    		expect(events[16].get("[ospf][prefix-id]")).to eq("138.132.0.0")
	    		expect(events[15].get("[ospf][netmask]")).to eq("255.255.255.255")
	    		expect(events[16].get("[ospf][netmask]")).to eq("255.255.0.0")
	    		expect(events[15].get("[ospf][ospf_metric]")).to eq("20")
	    		expect(events[16].get("[ospf][ospf_metric]")).to eq("20")
	    		expect(events[15].get("[ospf][prefix_ip_fwdaddr]")).to eq("172.16.12.9")
	    		expect(events[16].get("[ospf][prefix_ip_fwdaddr]")).to eq("0.0.0.0")
	    		expect(events[15].get("[ospf][ospf_external_tag]")).to eq("0")
	    		expect(events[16].get("[ospf][ospf_external_tag]")).to eq("0")
	    		expect(events[15].get("[ospf][lsa_down_bit]")).to eq(false)
	    		expect(events[16].get("[ospf][lsa_down_bit]")).to eq(false)
	    		expect(events[15].get("[ospf][lsa_external_bit]")).to eq(false)
	    		expect(events[16].get("[ospf][lsa_external_bit]")).to eq(false)
	    		expect(events[16].get("[ospf][metric_type]")).to eq(true)
	    		expect(events[16].get("[ospf][metric_type]")).to eq(true)
	    		expect(events[15].get("[ospf][area_id]")).to eq(0)
	    		expect(events[16].get("[ospf][area_id]")).to eq(0)
	    		expect(events[15].get("[ospf][utc_time]")).to eq("2022-02-07T13:30:41.56923000Z")
	    		expect(events[16].get("[ospf][utc_time]")).to eq("2022-02-07T13:30:41.56923000Z")
	    	end
        end

	    context 'SINGLE LSA TYPE 7' do
	    	let(:message) { JSON.parse('{"timestamp":"1643723807640","layers":{"frame":{"frame_frame_encap_type":"25","frame_frame_time":"2022-02-01T13:56:47.640869000Z","frame_frame_offset_shift":"0.000000000","frame_frame_time_epoch":"1643723807.640869000","frame_frame_time_delta":"0.006883000","frame_frame_time_delta_displayed":"0.006883000","frame_frame_time_relative":"2139.682065000","frame_frame_number":"52","frame_frame_len":"100","frame_frame_cap_len":"100","frame_frame_marked":false,"frame_frame_ignored":false,"frame_frame_protocols":"sll:ip:ospf"},"sll":{"sll_sll_pkttype":"0","sll_sll_hatype":"778","sll_sll_halen":"0","sll_sll_unused":"ac:10:0c:0d:c0:a8:32:ba","sll_sll_gretype":"0x00000800"},"ip":{"ip_ip_version":"4","ip_ip_hdr_len":"20","ip_ip_dsfield":"0x000000c0","ip_ip_dsfield_dscp":"48","ip_ip_dsfield_ecn":"0","ip_ip_len":"84","ip_ip_id":"0x00003d4d","ip_ip_flags":"0x00000000","ip_ip_flags_rb":false,"ip_ip_flags_df":false,"ip_ip_flags_mf":false,"ip_ip_frag_offset":"0","ip_ip_ttl":"1","ip_ip_proto":"89","ip_ip_checksum":"0x00003e8f","ip_ip_checksum_status":"2","ip_ip_src":"174.174.174.1","ip_ip_addr":["174.174.174.1","224.0.0.5"],"ip_ip_src_host":"174.174.174.1","ip_ip_host":["174.174.174.1","224.0.0.5"],"ip_ip_dst":"224.0.0.5","ip_ip_dst_host":"224.0.0.5"},"ospf":{"ospf_ospf_header":null,"ospf_ospf_version":"2","ospf_ospf_msg":"4","ospf_ospf_msg_lsupdate":true,"ospf_ospf_packet_length":"64","ospf_ospf_srcrouter":"172.16.12.1","ospf_ospf_area_id":"0.0.0.4","ospf_ospf_checksum":"0x00008a5d","ospf_ospf_auth_type":"0","ospf_ospf_auth_none":"00:00:00:00:00:00:00:00","text":"LSA-type 7 (NSSA AS-External-LSA), len 36","ospf_ospf_ls_number_of_lsas":"1","ospf_ospf_lsa_age":"3","ospf_ospf_lsa_donotage":"0","ospf_ospf_v2_options":"0x00000020","ospf_ospf_v2_options_dn":false,"ospf_ospf_v2_options_o":false,"ospf_ospf_v2_options_dc":true,"ospf_ospf_v2_options_l":false,"ospf_ospf_v2_options_p":false,"ospf_ospf_v2_options_mc":false,"ospf_ospf_v2_options_e":false,"ospf_ospf_v2_options_mt":false,"ospf_ospf_lsa":"7","ospf_ospf_lsa_nssa":true,"ospf_ospf_lsa_id":"24.0.0.174","ospf_ospf_advrouter":"12.0.0.18","ospf_ospf_lsa_seqnum":"0x80000138","ospf_ospf_lsa_chksum":"0x0000750c","ospf_ospf_lsa_length":"36","ospf_ospf_lsa_asext_netmask":"255.255.255.255","ospf_ospf_lsa_asext_type":true,"ospf_ospf_lsa_tos":"0","ospf_ospf_metric":"20","ospf_ospf_lsa_asext_fwdaddr":"0.0.0.0","ospf_ospf_lsa_asext_extrttag":"0"}}}') }
	    	it "clone one event type 7" do
	            events = [event]
                subject.filter(event) {|e| events << e }
                expect(events.length).to eq(2)
	    		expect(events[1].get("[ospf][timestamp]")).to eq(events[0].get("[json_parsed][layers][frame][frame_frame_time_epoch]"))
	    		expect(events[1].get("[ospf][lsa_type]")).to eq(events[0].get("[json_parsed][layers][ospf][ospf_ospf_lsa]"))
	    		expect(events[1].get("[ospf][lsa_age]")).to eq(events[0].get("[json_parsed][layers][ospf][ospf_ospf_lsa_age]"))
	    		expect(events[1].get("[ospf][lsa_seqnum]")).to eq(2147483960)
	    		expect(events[1].get("[ospf][lsu_pointer]")).to eq("1643723807.640869000-4-172.16.12.1")
	    		expect(events[1].get("[ospf][adv_router]")).to eq(events[0].get("[json_parsed][layers][ospf][ospf_ospf_advrouter]"))
	    		expect(events[1].get("[ospf][prefix-id]")).to eq(events[0].get("[json_parsed][layers][ospf][ospf_ospf_lsa_id]"))
	    		expect(events[1].get("[ospf][netmask]")).to eq(events[0].get("[json_parsed][layers][ospf][ospf_ospf_lsa_asext_netmask]"))
	    		expect(events[1].get("[ospf][ospf_metric]")).to eq(events[0].get("[json_parsed][layers][ospf][ospf_ospf_metric]"))
	    		expect(events[1].get("[ospf][prefix_ip_fwdaddr]")).to eq(events[0].get("[json_parsed][layers][ospf][ospf_ospf_lsa_asext_fwdaddr]"))
	    		expect(events[1].get("[ospf][ospf_external_tag]")).to eq(events[0].get("[json_parsed][layers][ospf][ospf_ospf_lsa_asext_extrttag]"))
	    		expect(events[1].get("[ospf][lsa_down_bit]")).to eq(events[0].get("[json_parsed][layers][ospf][ospf_ospf_v2_options_dn]"))
	    		expect(events[1].get("[ospf][lsa_external_bit]")).to eq(events[0].get("[json_parsed][layers][ospf][ospf_ospf_v2_options_e]"))
	    		expect(events[1].get("[ospf][lsa_propagate_bit]")).to eq(events[0].get("[json_parsed][layers][ospf][ospf_ospf_v2_options_p]"))
	    		expect(events[1].get("[ospf][metric_type]")).to eq(events[0].get("[json_parsed][layers][ospf][ospf_ospf_lsa_asext_type]"))
	    		expect(events[1].get("[ospf][area_id]")).to eq(4)
	    		expect(events[1].get("[ospf][utc_time]")).to eq(events[0].get("[json_parsed][layers][frame][frame_frame_time]"))
	    		expect(events[1].get("[ospf][timestamp]")).to eq(events[0].get("[json_parsed][layers][frame][frame_frame_time_epoch]"))
	    		expect(events[1].get("[ospf][extra]")).to eq("")
	    		# not expected fields
	    		expect(events[1].get("[ospf][lsa_opaque_type]")).to eq(nil)
	    		expect(events[1].get("[ospf][mpls_linkcolor]")).to eq(nil)
	    		expect(events[1].get("[ospf][te_metric]")).to eq(nil)
	    		expect(events[1].get("[ospf][link_type]")).to eq(nil)
	    		expect(events[1].get("[ospf][link-id]")).to eq(nil)
	    	end
        end
       
	    context 'MIX LSA WITH 2 LSA TYPE 7' do
	    	let(:message) { JSON.parse('{"timestamp":"1645614536246","layers":{"frame":{"frame_frame_encap_type":"25","frame_frame_time":"2022-02-23T11:08:56.246892000Z","frame_frame_offset_shift":"0.000000000","frame_frame_time_epoch":"1645614536.246892000","frame_frame_time_delta":"0.032011000","frame_frame_time_delta_displayed":"0.032011000","frame_frame_time_relative":"2881.344225000","frame_frame_number":"92","frame_frame_len":"864","frame_frame_cap_len":"864","frame_frame_marked":false,"frame_frame_ignored":false,"frame_frame_protocols":"sll:ip:ospf"},"sll":{"sll_sll_pkttype":"0","sll_sll_hatype":"778","sll_sll_halen":"0","sll_sll_unused":"00:00:00:00:00:00:00:00","sll_sll_gretype":"0x00000800"},"ip":{"ip_ip_version":"4","ip_ip_hdr_len":"20","ip_ip_dsfield":"0x000000c0","ip_ip_dsfield_dscp":"48","ip_ip_dsfield_ecn":"0","ip_ip_len":"848","ip_ip_id":"0x0000f247","ip_ip_flags":"0x00000000","ip_ip_flags_rb":false,"ip_ip_flags_df":false,"ip_ip_flags_mf":false,"ip_ip_frag_offset":"0","ip_ip_ttl":"1","ip_ip_proto":"89","ip_ip_checksum":"0x00008296","ip_ip_checksum_status":"2","ip_ip_src":"176.176.176.1","ip_ip_addr":["176.176.176.1","224.0.0.5"],"ip_ip_src_host":"176.176.176.1","ip_ip_host":["176.176.176.1","224.0.0.5"],"ip_ip_dst":"224.0.0.5","ip_ip_dst_host":"224.0.0.5"},"ospf":{"ospf_ospf_header":null,"ospf_ospf_version":"2","ospf_ospf_msg":"4","ospf_ospf_msg_lsupdate":true,"ospf_ospf_packet_length":"828","ospf_ospf_srcrouter":"12.0.0.17","ospf_ospf_area_id":"0.0.0.1","ospf_ospf_checksum":"0x0000c582","ospf_ospf_auth_type":"0","ospf_ospf_auth_none":"00:00:00:00:00:00:00:00","text":["LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 7 (NSSA AS-External-LSA), len 36","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 7 (NSSA AS-External-LSA), len 36","LSA-type 3 (Summary-LSA (IP network)), len 28"],"ospf_ospf_ls_number_of_lsas":"28","ospf_ospf_lsa_age":["2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2","2"],"ospf_ospf_lsa_donotage":["0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"ospf_ospf_v2_options":["0x00000028","0x00000028","0x00000028","0x00000028","0x00000028","0x00000028","0x00000028","0x00000028","0x00000028","0x00000028","0x00000028","0x00000028","0x00000028","0x00000028","0x00000028","0x00000028","0x00000028","0x00000028","0x00000028","0x00000028","0x00000028","0x00000028","0x00000028","0x00000028","0x00000020","0x00000028","0x00000020","0x00000028"],"ospf_ospf_v2_options_dn":[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false],"ospf_ospf_v2_options_o":[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false],"ospf_ospf_v2_options_dc":[true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true],"ospf_ospf_v2_options_l":[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false],"ospf_ospf_v2_options_n":[true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true],"ospf_ospf_v2_options_mc":[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false],"ospf_ospf_v2_options_e":[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false],"ospf_ospf_v2_options_mt":[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false],"ospf_ospf_lsa":["3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","3","7","3","7","3"],"ospf_ospf_lsa_summary":[true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true],"ospf_ospf_lsa_id":["12.0.0.11","192.168.50.220","172.16.12.4","12.0.0.4","192.168.50.140","172.16.22.10","172.16.12.10","192.168.50.100","192.168.50.64","174.174.174.0","172.16.12.8","12.0.0.8","172.16.12.9","12.0.0.9","192.168.50.8","192.168.101.0","172.16.12.16","12.0.0.16","192.168.50.80","192.168.50.144","192.168.50.128","192.168.50.124","172.16.12.12","124.0.0.12","0.0.0.0","192.168.50.4","174.0.0.0","192.168.100.76"],"ospf_ospf_advrouter":["12.0.0.18","12.0.0.18","12.0.0.18","12.0.0.18","12.0.0.18","12.0.0.18","12.0.0.18","12.0.0.18","12.0.0.18","12.0.0.18","12.0.0.18","12.0.0.18","12.0.0.18","12.0.0.18","12.0.0.18","12.0.0.18","12.0.0.18","12.0.0.18","12.0.0.18","12.0.0.18","12.0.0.18","12.0.0.18","12.0.0.18","12.0.0.18","12.0.0.18","12.0.0.18","12.0.0.18","12.0.0.18"],"ospf_ospf_lsa_seqnum":["0x800006bd","0x80000890","0x8000088f","0x8000088f","0x8000088f","0x80000890","0x80000890","0x8000088f","0x80000890","0x8000088f","0x80000890","0x80000890","0x8000088e","0x8000088e","0x80000891","0x800004d8","0x80000388","0x80000388","0x80000333","0x8000032a","0x800001f8","0x800001f9","0x800001fa","0x80000281","0x8000027f","0x80000204","0x80000125","0x80000484"],"ospf_ospf_lsa_chksum":["0x0000bf4c","0x00008851","0x0000c1de","0x00002f2e","0x0000b96f","0x0000422f","0x0000b0ca","0x0000adcd","0x0000791b","0x00004520","0x00003372","0x0000a0c1","0x00002d79","0x00009ac8","0x0000a922","0x0000df87","0x000093ee","0x0000013e","0x0000a244","0x00005f32","0x0000686c","0x00008e49","0x0000dc39","0x00007a2e","0x000031e1","0x0000fe64","0x0000b6f8","0x0000fc69"],"ospf_ospf_lsa_length":["28","28","28","28","28","28","28","28","28","28","28","28","28","28","28","28","28","28","28","28","28","28","28","28","36","28","36","28"],"ospf_ospf_lsa_asbr_netmask":["255.255.255.255","255.255.255.252","255.255.255.255","255.255.255.255","255.255.255.254","255.255.255.255","255.255.255.255","255.255.255.252","255.255.255.252","255.255.255.252","255.255.255.255","255.255.255.255","255.255.255.255","255.255.255.255","255.255.255.252","255.255.255.252","255.255.255.255","255.255.255.255","255.255.255.252","255.255.255.252","255.255.255.252","255.255.255.252","255.255.255.255","255.255.255.255","255.255.255.252","255.255.255.252"],"ospf_ospf_lsa_tos":["0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"ospf_ospf_metric":["51","50","21","21","50","51","51","10","20","65555","11","11","11","11","20","10","51","51","20","50","50","50","51","101","1","20","20","20"],"ospf_ospf_v2_options_p":[false,true],"ospf_ospf_lsa_nssa":[true,true],"ospf_ospf_lsa_asext_netmask":["0.0.0.0","255.255.255.252"],"ospf_ospf_lsa_asext_type":[true,true],"ospf_ospf_lsa_asext_fwdaddr":["0.0.0.0","0.0.0.0"],"ospf_ospf_lsa_asext_extrttag":["0","0"]}}}') }
	    	it "clone multiple events and check only 2 lsa type 7" do
	            events = [event]
                subject.filter(event) {|e| events << e }
                expect(events.length).to eq(29)
	    		expect(events[25].get("[ospf][timestamp]")).to eq("1645614536.246892000")
	    		expect(events[27].get("[ospf][timestamp]")).to eq("1645614536.246892000")
	    		expect(events[25].get("[ospf][lsa_type]")).to eq("7")
	    		expect(events[27].get("[ospf][lsa_type]")).to eq("7")
	    		expect(events[25].get("[ospf][lsa_age]")).to eq("2")
	    		expect(events[27].get("[ospf][lsa_age]")).to eq("2")
	    		expect(events[25].get("[ospf][lsa_seqnum]")).to eq(2147484287)
	    		expect(events[27].get("[ospf][lsa_seqnum]")).to eq(2147483941)
	    		expect(events[25].get("[ospf][lsu_pointer]")).to eq("1645614536.246892000-1-12.0.0.17")
	    		expect(events[27].get("[ospf][lsu_pointer]")).to eq("1645614536.246892000-1-12.0.0.17")
	    		expect(events[25].get("[ospf][adv_router]")).to eq("12.0.0.18")
	    		expect(events[27].get("[ospf][adv_router]")).to eq("12.0.0.18")
	    		expect(events[25].get("[ospf][prefix-id]")).to eq("0.0.0.0")
	    		expect(events[27].get("[ospf][prefix-id]")).to eq("174.0.0.0")
	    		expect(events[25].get("[ospf][netmask]")).to eq("0.0.0.0")
	    		expect(events[27].get("[ospf][netmask]")).to eq("255.255.255.252")
	    		expect(events[25].get("[ospf][ospf_metric]")).to eq("1")
	    		expect(events[27].get("[ospf][ospf_metric]")).to eq("20")
	    		expect(events[25].get("[ospf][prefix_ip_fwdaddr]")).to eq("0.0.0.0")
	    		expect(events[27].get("[ospf][prefix_ip_fwdaddr]")).to eq("0.0.0.0")
	    		expect(events[25].get("[ospf][ospf_external_tag]")).to eq("0")
	    		expect(events[27].get("[ospf][ospf_external_tag]")).to eq("0")
	    		expect(events[25].get("[ospf][lsa_down_bit]")).to eq(false)
	    		expect(events[27].get("[ospf][lsa_down_bit]")).to eq(false)
	    		expect(events[25].get("[ospf][lsa_external_bit]")).to eq(false)
	    		expect(events[27].get("[ospf][lsa_external_bit]")).to eq(false)
	    		expect(events[25].get("[ospf][lsa_propagate_bit]")).to eq(false)
	    		expect(events[27].get("[ospf][lsa_propagate_bit]")).to eq(true)
	    		expect(events[25].get("[ospf][metric_type]")).to eq(true)
	    		expect(events[27].get("[ospf][metric_type]")).to eq(true)
	    		expect(events[25].get("[ospf][area_id]")).to eq(1)
	    		expect(events[27].get("[ospf][area_id]")).to eq(1)
	    		expect(events[25].get("[ospf][utc_time]")).to eq("2022-02-23T11:08:56.246892000Z")
	    		expect(events[27].get("[ospf][utc_time]")).to eq("2022-02-23T11:08:56.246892000Z")
	    		expect(events[25].get("[ospf][extra]")).to eq("")
	    		expect(events[27].get("[ospf][extra]")).to eq("")
	    	end
        end

	    context 'SINGLE LSA TYPE 10 AND OPAQUE_TYPE 1' do
	    	let(:message) { JSON.parse('{"timestamp":"1644350043325","layers":{"frame":{"frame_frame_encap_type":"25","frame_frame_time":"2022-02-08T19:54:03.325759000Z","frame_frame_offset_shift":"0.000000000","frame_frame_time_epoch":"1644350043.325759000","frame_frame_time_delta":"65.551382000","frame_frame_time_delta_displayed":"65.551382000","frame_frame_time_relative":"3182.769872000","frame_frame_number":"84","frame_frame_len":"188","frame_frame_cap_len":"188","frame_frame_marked":false,"frame_frame_ignored":false,"frame_frame_protocols":"sll:ip:ospf"},"sll":{"sll_sll_pkttype":"4","sll_sll_hatype":"778","sll_sll_halen":"0","sll_sll_unused":"00:00:00:00:00:00:00:00","sll_sll_gretype":"0x00000800"},"ip":{"ip_ip_version":"4","ip_ip_hdr_len":"20","ip_ip_dsfield":"0x000000c0","ip_ip_dsfield_dscp":"48","ip_ip_dsfield_ecn":"0","ip_ip_len":"172","ip_ip_id":"0x0000b38f","ip_ip_flags":"0x00000000","ip_ip_flags_rb":false,"ip_ip_flags_df":false,"ip_ip_flags_mf":false,"ip_ip_frag_offset":"0","ip_ip_ttl":"1","ip_ip_proto":"89","ip_ip_checksum":"0x0000c5f2","ip_ip_checksum_status":"2","ip_ip_src":"175.175.175.2","ip_ip_addr":["175.175.175.2","224.0.0.5"],"ip_ip_src_host":"175.175.175.2","ip_ip_host":["175.175.175.2","224.0.0.5"],"ip_ip_dst":"224.0.0.5","ip_ip_dst_host":"224.0.0.5"},"ospf":{"ospf_ospf_header":null,"ospf_ospf_version":"2","ospf_ospf_msg":"4","ospf_ospf_msg_lsupdate":true,"ospf_ospf_packet_length":"152","ospf_ospf_srcrouter":"24.0.0.174","ospf_ospf_area_id":"0.0.0.0","ospf_ospf_mpls_linkcolor": "0x00000009","ospf_ospf_checksum":"0x00006434","ospf_ospf_auth_type":"0","ospf_ospf_auth_none":"00:00:00:00:00:00:00:00","text":["LSA-type 10 (Opaque LSA, Area-local scope), len 124","MPLS Traffic Engineering LSA","Router Address: 24.0.0.174","Link Information","Link Type: 1 - Point-to-point","Link ID: 124.0.0.7","Local Interface IP Address: 175.175.175.2","Remote Interface IP Address: 175.175.175.1","Traffic Engineering Metric: 4294967295","Maximum Bandwidth: 176258176 bytes/s (1410065408 bits/s)","Maximum Reservable Bandwidth: 176258176 bytes/s (1410065408 bits/s)","Unreserved Bandwidth"],"ospf_ospf_ls_number_of_lsas":"1","ospf_ospf_lsa_age":"1","ospf_ospf_lsa_donotage":"0","ospf_ospf_v2_options":"0x00000042","ospf_ospf_v2_options_dn":false,"ospf_ospf_v2_options_o":true,"ospf_ospf_v2_options_dc":false,"ospf_ospf_v2_options_l":false,"ospf_ospf_v2_options_n":false,"ospf_ospf_v2_options_mc":false,"ospf_ospf_v2_options_e":true,"ospf_ospf_v2_options_mt":false,"ospf_ospf_lsa":"10","ospf_ospf_lsa_opaque":true,"ospf_ospf_lsid_opaque_type":"1","ospf_ospf_lsid_te_lsa_reserved":"0","ospf_ospf_lsid_te_lsa_instance":"9","ospf_ospf_advrouter":"24.0.0.174","ospf_ospf_lsa_seqnum":"0x800000db","ospf_ospf_lsa_chksum":"0x00005e29","ospf_ospf_lsa_length":"124","ospf_ospf_tlv_type":["1","2","1","2","3","4","5","6","7","8"],"ospf_ospf_tlv_length":["4","92","1","4","4","4","4","4","4","32"],"ospf_ospf_mpls_routerid":"24.0.0.174","ospf_ospf_mpls_linktype":"1","ospf_ospf_mpls_linkid":"124.0.0.7","ospf_ospf_mpls_local_addr":"175.175.175.2","ospf_ospf_mpls_remote_addr":"175.175.175.1","ospf_ospf_mpls_te_metric":"4294967295","ospf_ospf_mpls_link_max_bw":["1.76258e+08","1.76258e+08"],"ospf_ospf_mpls_pri":["1.76258e+08","1.76258e+08","1.76258e+08","1.76258e+08","1.76258e+08","1.76258e+08","1.76258e+08","1.76258e+08"],"ospf_ospf_lsa_mpls":true}}}')}
	    	it "clone one event type 10" do
	            events = [event]
                subject.filter(event) {|e| events << e }
                expect(events.length).to eq(2)
	    		expect(events[1].get("[ospf][timestamp]")).to eq("1644350043.325759000")
	    		expect(events[1].get("[ospf][utc_time]")).to eq("2022-02-08T19:54:03.325759000Z")
	    		expect(events[1].get("[ospf][lsa_type]")).to eq("10")
	    		expect(events[1].get("[ospf][lsa_age]")).to eq("1")
	    		expect(events[1].get("[ospf][lsa_seqnum]")).to eq(2147483867)
	    		expect(events[1].get("[ospf][lsu_pointer]")).to eq("1644350043.325759000-0-24.0.0.174")
	    		expect(events[1].get("[ospf][adv_router]")).to eq("24.0.0.174")
	    		expect(events[1].get("[ospf][prefix-id]")).to eq("175.175.175.2")
	    		expect(events[1].get("[ospf][lsa_opaque_type]")).to eq("1")
	    		expect(events[1].get("[ospf][link-id]")).to eq("124.0.0.7")
	    		expect(events[1].get("[ospf][te_metric]")).to eq("4294967295")
	    		expect(events[1].get("[ospf][link_type]")).to eq("1")
	    		expect(events[1].get("[ospf][area_id]")).to eq(0) 
	    		expect(events[1].get("[ospf][mpls_linkcolor]")).to eq(9)
	    		expect(events[1].get("[ospf][extra]")).to eq("")
				# not expected fields
	    		expect(events[1].get("[ospf][netmask]")).to eq(nil)
	    		expect(events[1].get("[ospf][ospf_metric]")).to eq(nil)
	    		expect(events[1].get("[ospf][prefix_ip_fwdaddr]")).to eq(nil)
	    		expect(events[1].get("[ospf][ospf_external_tag]")).to eq(nil)
	    		expect(events[1].get("[ospf][lsa_down_bit]")).to eq(nil)
	    		expect(events[1].get("[ospf][lsa_external_bit]")).to eq(nil)
	    		expect(events[1].get("[ospf][lsa_propagate_bit]")).to eq(nil)
	    		expect(events[1].get("[ospf][metric_type]")).to eq(nil)
	    	end
        end

	    context 'SINGLE LSA TYPE 10 AND OPAQUE_TYPE 1 WITHOUT ospf_ospf_mpls_linkcolor' do
	    	let(:message) { JSON.parse('{"timestamp":"1644350043325","layers":{"frame":{"frame_frame_encap_type":"25","frame_frame_time":"2022-02-08T19:54:03.325759000Z","frame_frame_offset_shift":"0.000000000","frame_frame_time_epoch":"1644350043.325759000","frame_frame_time_delta":"65.551382000","frame_frame_time_delta_displayed":"65.551382000","frame_frame_time_relative":"3182.769872000","frame_frame_number":"84","frame_frame_len":"188","frame_frame_cap_len":"188","frame_frame_marked":false,"frame_frame_ignored":false,"frame_frame_protocols":"sll:ip:ospf"},"sll":{"sll_sll_pkttype":"4","sll_sll_hatype":"778","sll_sll_halen":"0","sll_sll_unused":"00:00:00:00:00:00:00:00","sll_sll_gretype":"0x00000800"},"ip":{"ip_ip_version":"4","ip_ip_hdr_len":"20","ip_ip_dsfield":"0x000000c0","ip_ip_dsfield_dscp":"48","ip_ip_dsfield_ecn":"0","ip_ip_len":"172","ip_ip_id":"0x0000b38f","ip_ip_flags":"0x00000000","ip_ip_flags_rb":false,"ip_ip_flags_df":false,"ip_ip_flags_mf":false,"ip_ip_frag_offset":"0","ip_ip_ttl":"1","ip_ip_proto":"89","ip_ip_checksum":"0x0000c5f2","ip_ip_checksum_status":"2","ip_ip_src":"175.175.175.2","ip_ip_addr":["175.175.175.2","224.0.0.5"],"ip_ip_src_host":"175.175.175.2","ip_ip_host":["175.175.175.2","224.0.0.5"],"ip_ip_dst":"224.0.0.5","ip_ip_dst_host":"224.0.0.5"},"ospf":{"ospf_ospf_header":null,"ospf_ospf_version":"2","ospf_ospf_msg":"4","ospf_ospf_msg_lsupdate":true,"ospf_ospf_packet_length":"152","ospf_ospf_srcrouter":"24.0.0.174","ospf_ospf_area_id":"0.0.0.0","ospf_ospf_checksum":"0x00006434","ospf_ospf_auth_type":"0","ospf_ospf_auth_none":"00:00:00:00:00:00:00:00","text":["LSA-type 10 (Opaque LSA, Area-local scope), len 124","MPLS Traffic Engineering LSA","Router Address: 24.0.0.174","Link Information","Link Type: 1 - Point-to-point","Link ID: 124.0.0.7","Local Interface IP Address: 175.175.175.2","Remote Interface IP Address: 175.175.175.1","Traffic Engineering Metric: 4294967295","Maximum Bandwidth: 176258176 bytes/s (1410065408 bits/s)","Maximum Reservable Bandwidth: 176258176 bytes/s (1410065408 bits/s)","Unreserved Bandwidth"],"ospf_ospf_ls_number_of_lsas":"1","ospf_ospf_lsa_age":"1","ospf_ospf_lsa_donotage":"0","ospf_ospf_v2_options":"0x00000042","ospf_ospf_v2_options_dn":false,"ospf_ospf_v2_options_o":true,"ospf_ospf_v2_options_dc":false,"ospf_ospf_v2_options_l":false,"ospf_ospf_v2_options_n":false,"ospf_ospf_v2_options_mc":false,"ospf_ospf_v2_options_e":true,"ospf_ospf_v2_options_mt":false,"ospf_ospf_lsa":"10","ospf_ospf_lsa_opaque":true,"ospf_ospf_lsid_opaque_type":"1","ospf_ospf_lsid_te_lsa_reserved":"0","ospf_ospf_lsid_te_lsa_instance":"9","ospf_ospf_advrouter":"24.0.0.174","ospf_ospf_lsa_seqnum":"0x800000db","ospf_ospf_lsa_chksum":"0x00005e29","ospf_ospf_lsa_length":"124","ospf_ospf_tlv_type":["1","2","1","2","3","4","5","6","7","8"],"ospf_ospf_tlv_length":["4","92","1","4","4","4","4","4","4","32"],"ospf_ospf_mpls_routerid":"24.0.0.174","ospf_ospf_mpls_linktype":"1","ospf_ospf_mpls_linkid":"124.0.0.7","ospf_ospf_mpls_local_addr":"175.175.175.2","ospf_ospf_mpls_remote_addr":"175.175.175.1","ospf_ospf_mpls_te_metric":"4294967295","ospf_ospf_mpls_link_max_bw":["1.76258e+08","1.76258e+08"],"ospf_ospf_mpls_pri":["1.76258e+08","1.76258e+08","1.76258e+08","1.76258e+08","1.76258e+08","1.76258e+08","1.76258e+08","1.76258e+08"],"ospf_ospf_lsa_mpls":true}}}')}
	    	it "clone one event type 10 and mpls_linkcolor nil" do
	            events = [event]
                subject.filter(event) {|e| events << e }
                expect(events.length).to eq(2)
	    		expect(events[1].get("[ospf][mpls_linkcolor]")).to eq(nil)
	    	end
        end
       
	    context 'SINGLE LSA TYPE 10 AND OPAQUE_TYPE 1 WITHOUT ospf_ospf_mpls_linktype' do
	    	let(:message) { JSON.parse('{"timestamp":"1644350043325","layers":{"frame":{"frame_frame_encap_type":"25","frame_frame_time":"2022-02-08T19:54:03.325759000Z","frame_frame_offset_shift":"0.000000000","frame_frame_time_epoch":"1644350043.325759000","frame_frame_time_delta":"65.551382000","frame_frame_time_delta_displayed":"65.551382000","frame_frame_time_relative":"3182.769872000","frame_frame_number":"84","frame_frame_len":"188","frame_frame_cap_len":"188","frame_frame_marked":false,"frame_frame_ignored":false,"frame_frame_protocols":"sll:ip:ospf"},"sll":{"sll_sll_pkttype":"4","sll_sll_hatype":"778","sll_sll_halen":"0","sll_sll_unused":"00:00:00:00:00:00:00:00","sll_sll_gretype":"0x00000800"},"ip":{"ip_ip_version":"4","ip_ip_hdr_len":"20","ip_ip_dsfield":"0x000000c0","ip_ip_dsfield_dscp":"48","ip_ip_dsfield_ecn":"0","ip_ip_len":"172","ip_ip_id":"0x0000b38f","ip_ip_flags":"0x00000000","ip_ip_flags_rb":false,"ip_ip_flags_df":false,"ip_ip_flags_mf":false,"ip_ip_frag_offset":"0","ip_ip_ttl":"1","ip_ip_proto":"89","ip_ip_checksum":"0x0000c5f2","ip_ip_checksum_status":"2","ip_ip_src":"175.175.175.2","ip_ip_addr":["175.175.175.2","224.0.0.5"],"ip_ip_src_host":"175.175.175.2","ip_ip_host":["175.175.175.2","224.0.0.5"],"ip_ip_dst":"224.0.0.5","ip_ip_dst_host":"224.0.0.5"},"ospf":{"ospf_ospf_header":null,"ospf_ospf_version":"2","ospf_ospf_msg":"4","ospf_ospf_msg_lsupdate":true,"ospf_ospf_packet_length":"152","ospf_ospf_srcrouter":"24.0.0.174","ospf_ospf_area_id":"0.0.0.0","ospf_ospf_checksum":"0x00006434","ospf_ospf_auth_type":"0","ospf_ospf_auth_none":"00:00:00:00:00:00:00:00","text":["LSA-type 10 (Opaque LSA, Area-local scope), len 124","MPLS Traffic Engineering LSA","Router Address: 24.0.0.174","Link Information","Link Type: 1 - Point-to-point","Link ID: 124.0.0.7","Local Interface IP Address: 175.175.175.2","Remote Interface IP Address: 175.175.175.1","Traffic Engineering Metric: 4294967295","Maximum Bandwidth: 176258176 bytes/s (1410065408 bits/s)","Maximum Reservable Bandwidth: 176258176 bytes/s (1410065408 bits/s)","Unreserved Bandwidth"],"ospf_ospf_ls_number_of_lsas":"1","ospf_ospf_lsa_age":"1","ospf_ospf_lsa_donotage":"0","ospf_ospf_v2_options":"0x00000042","ospf_ospf_v2_options_dn":false,"ospf_ospf_v2_options_o":true,"ospf_ospf_v2_options_dc":false,"ospf_ospf_v2_options_l":false,"ospf_ospf_v2_options_n":false,"ospf_ospf_v2_options_mc":false,"ospf_ospf_v2_options_e":true,"ospf_ospf_v2_options_mt":false,"ospf_ospf_lsa":"10","ospf_ospf_lsa_opaque":true,"ospf_ospf_lsid_opaque_type":"1","ospf_ospf_lsid_te_lsa_reserved":"0","ospf_ospf_lsid_te_lsa_instance":"9","ospf_ospf_advrouter":"24.0.0.174","ospf_ospf_lsa_seqnum":"0x800000db","ospf_ospf_lsa_chksum":"0x00005e29","ospf_ospf_lsa_length":"124","ospf_ospf_tlv_type":["1","2","1","2","3","4","5","6","7","8"],"ospf_ospf_tlv_length":["4","92","1","4","4","4","4","4","4","32"],"ospf_ospf_mpls_routerid":"24.0.0.174","ospf_ospf_mpls_linkid":"124.0.0.7","ospf_ospf_mpls_local_addr":"175.175.175.2","ospf_ospf_mpls_remote_addr":"175.175.175.1","ospf_ospf_mpls_te_metric":"4294967295","ospf_ospf_mpls_link_max_bw":["1.76258e+08","1.76258e+08"],"ospf_ospf_mpls_pri":["1.76258e+08","1.76258e+08","1.76258e+08","1.76258e+08","1.76258e+08","1.76258e+08","1.76258e+08","1.76258e+08"],"ospf_ospf_lsa_mpls":true}}}')}
	    	it "clone one event type 10 and link_type nil" do
	            events = [event]
                subject.filter(event) {|e| events << e }
                expect(events.length).to eq(2)
	    		expect(events[1].get("[ospf][link_type]")).to eq(nil)
	    	end
        end
       
	    context 'MIX LSA WITH ONLY 2 LSA TYPE 10 AND OPAQUE_TYPE 1' do
	    	let(:message) { JSON.parse('{"timestamp":"1645612171635","layers":{"frame":{"frame_frame_encap_type":"25","frame_frame_time":"2022-02-23T10:29:31.635820000Z","frame_frame_offset_shift":"0.000000000","frame_frame_time_epoch":"1645612171.635820000","frame_frame_time_delta":"47.832329000","frame_frame_time_delta_displayed":"47.832329000","frame_frame_time_relative":"516.733153000","frame_frame_number":"12","frame_frame_len":"528","frame_frame_cap_len":"528","frame_frame_marked":false,"frame_frame_ignored":false,"frame_frame_protocols":"sll:ip:ospf"},"sll":{"sll_sll_pkttype":"0","sll_sll_hatype":"778","sll_sll_halen":"0","sll_sll_unused":"00:00:00:00:00:00:00:00","sll_sll_gretype":"0x00000800"},"ip":{"ip_ip_version":"4","ip_ip_hdr_len":"20","ip_ip_dsfield":"0x000000c0","ip_ip_dsfield_dscp":"48","ip_ip_dsfield_ecn":"0","ip_ip_len":"512","ip_ip_id":"0x000020d0","ip_ip_flags":"0x00000000","ip_ip_flags_rb":false,"ip_ip_flags_df":false,"ip_ip_flags_mf":false,"ip_ip_frag_offset":"0","ip_ip_ttl":"1","ip_ip_proto":"89","ip_ip_checksum":"0x0000535d","ip_ip_checksum_status":"2","ip_ip_src":"177.177.177.1","ip_ip_addr":["177.177.177.1","224.0.0.5"],"ip_ip_src_host":"177.177.177.1","ip_ip_host":["177.177.177.1","224.0.0.5"],"ip_ip_dst":"224.0.0.5","ip_ip_dst_host":"224.0.0.5"},"ospf":{"ospf_ospf_header":null,"ospf_ospf_version":"2","ospf_ospf_msg":"4","ospf_ospf_msg_lsupdate":true,"ospf_ospf_packet_length":"492","ospf_ospf_srcrouter":"124.0.0.7","ospf_ospf_area_id":"0.0.0.8","ospf_ospf_checksum":"0x00002240","ospf_ospf_auth_type":"0","ospf_ospf_auth_none":"00:00:00:00:00:00:00:00","text":["LSA-type 10 (Opaque LSA, Area-local scope), len 28","MPLS Traffic Engineering LSA","Router Address: 24.0.0.1","LSA-type 10 (Opaque LSA, Area-local scope), len 44","OSPFv2 Extended Prefix Opaque LSA","OSPFv2 Extended Prefix TLV  (Type: Intra-Area    Prefix: 172.16.24.1/32)","Prefix SID Sub-TLV  (SID/Label: 2001)","LSA-type 1 (Router-LSA), len 84","Type: Stub     ID: 24.0.0.1        Data: 255.255.255.255 Metric: 1","Type: Stub     ID: 172.16.24.1     Data: 255.255.255.255 Metric: 1","Type: Stub     ID: 192.168.100.64  Data: 255.255.255.252 Metric: 10","Type: PTP      ID: 24.0.0.4        Data: 192.168.100.6   Metric: 10","Type: Stub     ID: 192.168.100.4   Data: 255.255.255.252 Metric: 10","LSA-type 10 (Opaque LSA, Area-local scope), len 88","Opaque Router Information LSA","Router Informational Capabilities","SR-Algorithm ","SID/Label Range  (Range Size: 8000)","SID/Label Sub-TLV  (SID/Label: 16000)","Node MSD","SR Local Block  (Range Size: 1000)","SID/Label Sub-TLV  (SID/Label: 15000)","OSPF Dynamic Hostname","LSA-type 10 (Opaque LSA, Area-local scope), len 140","OSPFv2 Extended Link Opaque LSA","OSPFv2 Extended Link TLV  (Type: PTP      ID: 24.0.0.4        Data: 192.168.100.6)","Adj-SID Sub-TLV  (SID/Label: 24000)","Adj-SID Sub-TLV  (SID/Label: 24001)","Local/Remote Interface ID Sub-TLV  (Local: 6, Remote: 7)","Unknown Sub-TLV","Remote IPv4 Address Sub-TLV  (192.168.100.5)","Unknown Sub-TLV","Link MSD Sub-TLV","Unknown Sub-TLV","Unknown Sub-TLV","LSA-type 10 (Opaque LSA, Area-local scope), len 80","MPLS Traffic Engineering LSA","Link Information","Link Type: 1 - Point-to-point","Link ID: 24.0.0.4","Local Interface IP Address: 192.168.100.6","Remote Interface IP Address: 192.168.100.5","Traffic Engineering Metric: 65535","Maximum Bandwidth: 125000000 bytes/s (1000000000 bits/s)","Unknown Link sub-TLV: 32770 (For Experimental Use)"],"ospf_ospf_ls_number_of_lsas":"6","ospf_ospf_lsa_age":["4","4","4","4","4","4"],"ospf_ospf_lsa_donotage":["0","0","0","0","0","0"],"ospf_ospf_v2_options":["0x00000020","0x00000020","0x00000028","0x00000020","0x00000020","0x00000020"],"ospf_ospf_v2_options_dn":[false,false,false,false,false,false],"ospf_ospf_v2_options_o":[false,false,false,false,false,false],"ospf_ospf_v2_options_dc":[true,true,true,true,true,true],"ospf_ospf_v2_options_l":[false,false,false,false,false,false],"ospf_ospf_v2_options_n":[false,false,true,false,false,false],"ospf_ospf_v2_options_mc":[false,false,false,false,false,false],"ospf_ospf_v2_options_e":[false,false,false,false,false,false],"ospf_ospf_v2_options_mt":[false,false,false,false,false,false],"ospf_ospf_lsa":["10","10","1","10","10","10"],"ospf_ospf_lsa_opaque":[true,true,true,true,true],"ospf_ospf_lsid_opaque_type":["1","7","4","8","1"],"ospf_ospf_lsid_te_lsa_reserved":["0","0"],"ospf_ospf_lsid_te_lsa_instance":["0","6"],"ospf_ospf_advrouter":["24.0.0.1","24.0.0.1","24.0.0.1","24.0.0.1","24.0.0.1","24.0.0.1"],"ospf_ospf_lsa_seqnum":["0x80000866","0x80000867","0x8000086a","0x80000867","0x80000866","0x80000867"],"ospf_ospf_lsa_chksum":["0x0000454d","0x00006603","0x000087ea","0x00003d44","0x00009a36","0x00004bac"],"ospf_ospf_lsa_length":["28","44","84","88","140","80"],"ospf_ospf_tlv_type":["1","2","1","2","3","4","5","6","32770"],"ospf_ospf_tlv_length":["4","20","8","4","2","12","3","2","12","3","7","116","7","7","8","12","4","4","2","4","16","56","1","4","4","4","4","4","4"],"ospf_ospf_mpls_routerid":"24.0.0.1","ospf_ospf_lsa_mpls":[true,true],"ospf_ospf_lsid_opaque_id":["1","0","6"],"ospf_ospf_tlv_extpfx_tlv_type":"1","ospf_ospf_tlv_extpfx_rotuetype":"1","ospf_ospf_prefix_length":"32","ospf_ospf_tlv_extpfx_af":"0","ospf_ospf_tlv_extpfx_flags":"0x00000040","ospf_ospf_tlv_extpfx_flags_a":false,"ospf_ospf_tlv_extpfx_flags_n":true,"ospf_ospf_v3_address_prefix_ipv4":"172.16.24.1","ospf_ospf_tlv_extpfx_subtlv_type":"2","ospf_ospf_tlv_pfxsid_flags":"0x00000000","ospf_ospf_tlv_pfxsid_flags_np":false,"ospf_ospf_tlv_pfxsid_flags_m":false,"ospf_ospf_tlv_pfxsid_flags_e":false,"ospf_ospf_tlv_pfxsid_flags_v":false,"ospf_ospf_tlv_pfxsid_flags_l":false,"ospf_ospf_reserved":["00","00","00","00:00:00","00","00"],"ospf_ospf_tlv_extlink_mt_id":["0","0","0"],"ospf_ospf_lsa_sa":["0","0","1"],"ospf_ospf_tlv_sid_label":["2001","16000","15000","24000","24001"],"ospf_ospf_lsa_router":true,"ospf_ospf_lsa_id":"24.0.0.1","ospf_ospf_v2_router_lsa_flags":"0x00000000","ospf_ospf_v2_router_lsa_flags_h":false,"ospf_ospf_v2_router_lsa_flags_n":false,"ospf_ospf_v2_router_lsa_flags_w":false,"ospf_ospf_v2_router_lsa_flags_v":false,"ospf_ospf_v2_router_lsa_flags_e":false,"ospf_ospf_v2_router_lsa_flags_b":false,"ospf_ospf_lsa_number_of_links":"5","ospf_ospf_lsa_router_linkid":["24.0.0.1","172.16.24.1","192.168.100.64","24.0.0.4","192.168.100.4","24.0.0.4"],"ospf_ospf_lsa_router_linkdata":["255.255.255.255","255.255.255.255","255.255.255.252","192.168.100.6","255.255.255.252","192.168.100.6"],"ospf_ospf_lsa_router_linktype":["3","3","3","1","3","1"],"ospf_ospf_lsa_router_nummetrics":["0","0","0","0","0"],"ospf_ospf_lsa_router_metric0":["1","1","10","10","10"],"ospf_ospf_tlv_type_opaque":["1","8","9","12","14","7"],"ospf_ospf_ri_options":"0x000000e0","ospf_ospf_ri_options_grc":true,"ospf_ospf_ri_options_grh":true,"ospf_ospf_ri_options_srs":true,"ospf_ospf_ri_options_tes":false,"ospf_ospf_ri_options_p2plan":false,"ospf_ospf_ri_options_ete":false,"ospf_ospf_ri_options_host":false,"ospf_ospf_tlv_range_size":["8000","1000"],"ospf_ospf_tlv_sidlabel_range_type":["1","1"],"ospf_ospf_tlv_igp_msd_type":["1","1"],"ospf_ospf_tlv_igp_msd_value":["10","10"],"ospf_ospf_dynhostname":"RGAV001","ospf_ospf_tlv_extlink_tlv_type":"1","ospf_ospf_tlv_extlink_subtlv_type":["2","2","9","32769","8","32768","6","21","10"],"ospf_ospf_tlv_adjsid_flags":["0x00000060","0x000000e0"],"ospf_ospf_tlv_adjsid_flags_b":[false,true,true,true],"ospf_ospf_tlv_adjsid_flags_v":[true,true],"ospf_ospf_tlv_adjsid_flags_g":[false,false],"ospf_ospf_tlv_adjsid_flags_p":[false,false],"ospf_ospf_tlv_extlink_weight":["0","0"],"ospf_ospf_tlv_local_interface_id":"6","ospf_ospf_tlv_remote_interface_id":"7","ospf_ospf_tlv_value":["00:00:00:09:00:00:00:06:00:00:00:07","c0:a8:64:05","4c:ee:6b:28","04:00:00:00:40:00:00:00:00:16:00:04:00:00:ff:ff","00:00:ff:ff"],"ospf_ospf_tlv_remote_ipv4_address":"192.168.100.5","ospf_ospf_mpls_linktype":"1","ospf_ospf_mpls_linkid":"24.0.0.4","ospf_ospf_mpls_local_addr":"192.168.100.6","ospf_ospf_mpls_remote_addr":"192.168.100.5","ospf_ospf_mpls_te_metric":"65535","ospf_ospf_mpls_link_max_bw":"1.25e+08"}}}')}
	    	it "clone two events type 10 and drop others, until i dont develop them" do
	            events = [event]
                subject.filter(event) {|e| events << e }
                expect(events.length).to eq(3)
                expect(events[1].get("[ospf][adv_router]")).to eq("24.0.0.1")
                expect(events[2].get("[ospf][adv_router]")).to eq("24.0.0.1")
                expect(events[1].get("[ospf][link_type]")).to eq("1")
                expect(events[2].get("[ospf][link_type]")).to eq("1")
                expect(events[1].get("[ospf][link-id]")).to eq("24.0.0.4")
                expect(events[2].get("[ospf][link-id]")).to eq("24.0.0.4")
                expect(events[1].get("[ospf][prefix-id]")).to eq("192.168.100.6")
                expect(events[2].get("[ospf][prefix-id]")).to eq("192.168.100.6")
                expect(events[1].get("[ospf][te_metric]")).to eq("65535")
                expect(events[2].get("[ospf][te_metric]")).to eq("65535")
                expect(events[1].get("[ospf][mpls_linkcolor]")).to eq(nil)
                expect(events[2].get("[ospf][mpls_linkcolor]")).to eq(nil)
	    	end
        end
       
	    context 'SINGLE LSA TYPE 1 AND 1 LINKID' do
	    	let(:message) { JSON.parse('{"timestamp":"1643721667958","layers":{"frame":{"frame_frame_encap_type":"25","frame_frame_time":"2022-02-01T13:21:07.958804000Z","frame_frame_offset_shift":"0.000000000","frame_frame_time_epoch":"1643721667.958804000","frame_frame_time_delta":"0.000000000","frame_frame_time_delta_displayed":"0.000000000","frame_frame_time_relative":"0.000000000","frame_frame_number":"1","frame_frame_len":"196","frame_frame_cap_len":"196","frame_frame_marked":false,"frame_frame_ignored":false,"frame_frame_protocols":"sll:ip:ospf"},"sll":{"sll_sll_pkttype":"0","sll_sll_hatype":"778","sll_sll_halen":"0","sll_sll_unused":"00:00:00:00:00:00:00:00","sll_sll_gretype":"0x00000800"},"ip":{"ip_ip_version":"4","ip_ip_hdr_len":"20","ip_ip_dsfield":"0x000000c0","ip_ip_dsfield_dscp":"48","ip_ip_dsfield_ecn":"0","ip_ip_len":"180","ip_ip_id":"0x00005f3e","ip_ip_flags":"0x00000000","ip_ip_flags_rb":false,"ip_ip_flags_df":false,"ip_ip_flags_mf":false,"ip_ip_frag_offset":"0","ip_ip_ttl":"1","ip_ip_proto":"89","ip_ip_checksum":"0x0000163b","ip_ip_checksum_status":"2","ip_ip_src":"177.177.177.1","ip_ip_addr":["177.177.177.1","224.0.0.5"],"ip_ip_src_host":"177.177.177.1","ip_ip_host":["177.177.177.1","224.0.0.5"],"ip_ip_dst":"224.0.0.5","ip_ip_dst_host":"224.0.0.5"},"ospf":{"ospf_ospf_header":null,"ospf_ospf_version":"2","ospf_ospf_msg":"4","ospf_ospf_msg_lsupdate":true,"ospf_ospf_packet_length":"160","ospf_ospf_srcrouter":"124.0.0.7","ospf_ospf_area_id":"0.0.0.8","ospf_ospf_checksum":"0x00006b5f","ospf_ospf_auth_type":"0","ospf_ospf_auth_none":"00:00:00:00:00:00:00:00","text":["LSA-type 1 (Router-LSA), len 132","Type: Stub     ID: 9.9.9.1         Data: 255.255.255.255 Metric: 1","Type: Stub     ID: 192.168.100.64  Data: 255.255.255.252 Metric: 10","Type: Stub     ID: 192.168.100.68  Data: 255.255.255.252 Metric: 10","Type: Stub     ID: 192.168.100.72  Data: 255.255.255.252 Metric: 10","Type: Stub     ID: 192.168.100.20  Data: 255.255.255.252 Metric: 10","Type: PTP      ID: 24.0.0.4        Data: 192.168.100.26  Metric: 65535","Type: Stub     ID: 192.168.100.24  Data: 255.255.255.252 Metric: 10","Type: PTP      ID: 124.0.0.7       Data: 192.168.100.78  Metric: 65535","Type: Stub     ID: 192.168.100.76  Data: 255.255.255.252 Metric: 10"],"ospf_ospf_ls_number_of_lsas":"1","ospf_ospf_lsa_age":"2","ospf_ospf_lsa_donotage":"0","ospf_ospf_v2_options":"0x00000028","ospf_ospf_v2_options_dn":false,"ospf_ospf_v2_options_o":false,"ospf_ospf_v2_options_dc":true,"ospf_ospf_v2_options_l":false,"ospf_ospf_v2_options_n":true,"ospf_ospf_v2_options_mc":false,"ospf_ospf_v2_options_e":false,"ospf_ospf_v2_options_mt":false,"ospf_ospf_lsa":"1","ospf_ospf_lsa_router":true,"ospf_ospf_lsa_id":"24.0.0.5","ospf_ospf_advrouter":"24.0.0.5","ospf_ospf_lsa_seqnum":"0x800004bf","ospf_ospf_lsa_chksum":"0x0000525c","ospf_ospf_lsa_length":"132","ospf_ospf_v2_router_lsa_flags":"0x00000002","ospf_ospf_v2_router_lsa_flags_h":false,"ospf_ospf_v2_router_lsa_flags_n":false,"ospf_ospf_v2_router_lsa_flags_w":false,"ospf_ospf_v2_router_lsa_flags_v":false,"ospf_ospf_v2_router_lsa_flags_e":true,"ospf_ospf_v2_router_lsa_flags_b":false,"ospf_ospf_lsa_number_of_links":"9","ospf_ospf_lsa_router_linkid":"9.9.9.1","ospf_ospf_lsa_router_linkdata":"255.255.255.255","ospf_ospf_lsa_router_linktype":"3","ospf_ospf_lsa_router_nummetrics":"0","ospf_ospf_lsa_router_metric0":"1"}}}')}
	    	it "clone one event type 10" do
	            events = [event]
                subject.filter(event) {|e| events << e }
                expect(events.length).to eq(1)
	    	end
        end
       
	    context 'SINGLE LSA TYPE 1 AND 9 LINKID' do
	    	let(:message) { JSON.parse('{"timestamp":"1643721667958","layers":{"frame":{"frame_frame_encap_type":"25","frame_frame_time":"2022-02-01T13:21:07.958804000Z","frame_frame_offset_shift":"0.000000000","frame_frame_time_epoch":"1643721667.958804000","frame_frame_time_delta":"0.000000000","frame_frame_time_delta_displayed":"0.000000000","frame_frame_time_relative":"0.000000000","frame_frame_number":"1","frame_frame_len":"196","frame_frame_cap_len":"196","frame_frame_marked":false,"frame_frame_ignored":false,"frame_frame_protocols":"sll:ip:ospf"},"sll":{"sll_sll_pkttype":"0","sll_sll_hatype":"778","sll_sll_halen":"0","sll_sll_unused":"00:00:00:00:00:00:00:00","sll_sll_gretype":"0x00000800"},"ip":{"ip_ip_version":"4","ip_ip_hdr_len":"20","ip_ip_dsfield":"0x000000c0","ip_ip_dsfield_dscp":"48","ip_ip_dsfield_ecn":"0","ip_ip_len":"180","ip_ip_id":"0x00005f3e","ip_ip_flags":"0x00000000","ip_ip_flags_rb":false,"ip_ip_flags_df":false,"ip_ip_flags_mf":false,"ip_ip_frag_offset":"0","ip_ip_ttl":"1","ip_ip_proto":"89","ip_ip_checksum":"0x0000163b","ip_ip_checksum_status":"2","ip_ip_src":"177.177.177.1","ip_ip_addr":["177.177.177.1","224.0.0.5"],"ip_ip_src_host":"177.177.177.1","ip_ip_host":["177.177.177.1","224.0.0.5"],"ip_ip_dst":"224.0.0.5","ip_ip_dst_host":"224.0.0.5"},"ospf":{"ospf_ospf_header":null,"ospf_ospf_version":"2","ospf_ospf_msg":"4","ospf_ospf_msg_lsupdate":true,"ospf_ospf_packet_length":"160","ospf_ospf_srcrouter":"124.0.0.7","ospf_ospf_area_id":"0.0.0.8","ospf_ospf_checksum":"0x00006b5f","ospf_ospf_auth_type":"0","ospf_ospf_auth_none":"00:00:00:00:00:00:00:00","text":["LSA-type 1 (Router-LSA), len 132","Type: Stub     ID: 9.9.9.1         Data: 255.255.255.255 Metric: 1","Type: Stub     ID: 192.168.100.64  Data: 255.255.255.252 Metric: 10","Type: Stub     ID: 192.168.100.68  Data: 255.255.255.252 Metric: 10","Type: Stub     ID: 192.168.100.72  Data: 255.255.255.252 Metric: 10","Type: Stub     ID: 192.168.100.20  Data: 255.255.255.252 Metric: 10","Type: PTP      ID: 24.0.0.4        Data: 192.168.100.26  Metric: 65535","Type: Stub     ID: 192.168.100.24  Data: 255.255.255.252 Metric: 10","Type: PTP      ID: 124.0.0.7       Data: 192.168.100.78  Metric: 65535","Type: Stub     ID: 192.168.100.76  Data: 255.255.255.252 Metric: 10"],"ospf_ospf_ls_number_of_lsas":"1","ospf_ospf_lsa_age":"2","ospf_ospf_lsa_donotage":"0","ospf_ospf_v2_options":"0x00000028","ospf_ospf_v2_options_dn":false,"ospf_ospf_v2_options_o":false,"ospf_ospf_v2_options_dc":true,"ospf_ospf_v2_options_l":false,"ospf_ospf_v2_options_n":true,"ospf_ospf_v2_options_mc":false,"ospf_ospf_v2_options_e":false,"ospf_ospf_v2_options_mt":false,"ospf_ospf_lsa":"1","ospf_ospf_lsa_router":true,"ospf_ospf_lsa_id":"24.0.0.5","ospf_ospf_advrouter":"24.0.0.5","ospf_ospf_lsa_seqnum":"0x800004bf","ospf_ospf_lsa_chksum":"0x0000525c","ospf_ospf_lsa_length":"132","ospf_ospf_v2_router_lsa_flags":"0x00000002","ospf_ospf_v2_router_lsa_flags_h":false,"ospf_ospf_v2_router_lsa_flags_n":false,"ospf_ospf_v2_router_lsa_flags_w":false,"ospf_ospf_v2_router_lsa_flags_v":false,"ospf_ospf_v2_router_lsa_flags_e":true,"ospf_ospf_v2_router_lsa_flags_b":false,"ospf_ospf_lsa_number_of_links":"9","ospf_ospf_lsa_router_linkid":["9.9.9.1","192.168.100.64","192.168.100.68","192.168.100.72","192.168.100.20","24.0.0.4","192.168.100.24","124.0.0.7","192.168.100.76"],"ospf_ospf_lsa_router_linkdata":["255.255.255.255","255.255.255.252","255.255.255.252","255.255.255.252","255.255.255.252","192.168.100.26","255.255.255.252","192.168.100.78","255.255.255.252"],"ospf_ospf_lsa_router_linktype":["3","3","3","3","3","1","3","1","3"],"ospf_ospf_lsa_router_nummetrics":["0","0","0","0","0","0","0","0","0"],"ospf_ospf_lsa_router_metric0":["1","10","10","10","10","65535","10","65535","10"]}}}')}
	    	it "clone one event type 10" do
	            events = [event]
                subject.filter(event) {|e| events << e }
                expect(events.length).to eq(1)
	    	end
        end
       
	    context 'MIX LSA TYPE TODO' do
	    	let(:message) { JSON.parse('{"timestamp":"1644347306076","layers":{"frame":{"frame_frame_encap_type":"25","frame_frame_time":"2022-02-08T19:08:26.76272000Z","frame_frame_offset_shift":"0.000000000","frame_frame_time_epoch":"1644347306.076272000","frame_frame_time_delta":"0.000048000","frame_frame_time_delta_displayed":"0.000048000","frame_frame_time_relative":"445.520385000","frame_frame_number":"13","frame_frame_len":"796","frame_frame_cap_len":"796","frame_frame_marked":false,"frame_frame_ignored":false,"frame_frame_protocols":"sll:ip:ospf"},"sll":{"sll_sll_pkttype":"0","sll_sll_hatype":"778","sll_sll_halen":"0","sll_sll_unused":"00:00:00:00:00:00:00:00","sll_sll_gretype":"0x00000800"},"ip":{"ip_ip_version":"4","ip_ip_hdr_len":"20","ip_ip_dsfield":"0x000000c0","ip_ip_dsfield_dscp":"48","ip_ip_dsfield_ecn":"0","ip_ip_len":"780","ip_ip_id":"0x00009d20","ip_ip_flags":"0x00000000","ip_ip_flags_rb":false,"ip_ip_flags_df":false,"ip_ip_flags_mf":false,"ip_ip_frag_offset":"0","ip_ip_ttl":"1","ip_ip_proto":"89","ip_ip_checksum":"0x0000da02","ip_ip_checksum_status":"2","ip_ip_src":"175.175.175.1","ip_ip_addr":["175.175.175.1","224.0.0.5"],"ip_ip_src_host":"175.175.175.1","ip_ip_host":["175.175.175.1","224.0.0.5"],"ip_ip_dst":"224.0.0.5","ip_ip_dst_host":"224.0.0.5"},"ospf":{"ospf_ospf_header":null,"ospf_ospf_version":"2","ospf_ospf_msg":"4","ospf_ospf_msg_lsupdate":true,"ospf_ospf_packet_length":"760","ospf_ospf_srcrouter":"124.0.0.7","ospf_ospf_area_id":"0.0.0.0","ospf_ospf_checksum":"0x00002336","ospf_ospf_auth_type":"0","ospf_ospf_auth_none":"00:00:00:00:00:00:00:00","text":["LSA-type 1 (Router-LSA), len 108","Type: Stub     ID: 124.0.0.7       Data: 255.255.255.255 Metric: 1","Type: Stub     ID: 172.16.24.7     Data: 255.255.255.255 Metric: 1","Type: PTP      ID: 24.0.0.174      Data: 175.175.175.1   Metric: 65535","Type: Stub     ID: 175.175.175.0   Data: 255.255.255.252 Metric: 65535","Type: Stub     ID: 192.168.100.160 Data: 255.255.255.252 Metric: 10","Type: PTP      ID: 12.0.0.18       Data: 192.168.102.2   Metric: 10","Type: Stub     ID: 192.168.102.0   Data: 255.255.255.252 Metric: 10","LSA-type 10 (Opaque LSA, Area-local scope), len 204","MPLS Traffic Engineering LSA","Link Information","Link Type: 1 - Point-to-point","Link ID: 24.0.0.174","Local Interface IP Address: 175.175.175.1","Remote Interface IP Address: 175.175.175.2","Traffic Engineering Metric: 65535","Maximum Bandwidth: 12500 bytes/s (100000 bits/s)","Maximum Reservable Bandwidth: 0 bytes/s (0 bits/s)","Unreserved Bandwidth","Resource Class/Color: 0x00000000","Unknown Link sub-TLV: 32770 (For Experimental Use)","Unknown Link sub-TLV: 26 (Assigned via Standards Action)","Unknown Link sub-TLV: 32771 (For Experimental Use)","LSA-type 10 (Opaque LSA, Area-local scope), len 28","MPLS Traffic Engineering LSA","Router Address: 124.0.0.7","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28","LSA-type 3 (Summary-LSA (IP network)), len 28"],"ospf_ospf_ls_number_of_lsas":"17","ospf_ospf_lsa_age":["1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1"],"ospf_ospf_lsa_donotage":["0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"ospf_ospf_v2_options":["0x00000022","0x00000020","0x00000020","0x00000022","0x00000022","0x00000022","0x00000022","0x00000022","0x00000022","0x00000022","0x00000022","0x00000022","0x00000022","0x00000022","0x00000022","0x00000022","0x00000022"],"ospf_ospf_v2_options_dn":[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false],"ospf_ospf_v2_options_o":[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false],"ospf_ospf_v2_options_dc":[true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true],"ospf_ospf_v2_options_l":[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false],"ospf_ospf_v2_options_n":[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false],"ospf_ospf_v2_options_mc":[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false],"ospf_ospf_v2_options_e":[true,false,false,true,true,true,true,true,true,true,true,true,true,true,true,true,true],"ospf_ospf_v2_options_mt":[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false],"ospf_ospf_lsa":["1","10","10","3","3","3","3","3","3","3","3","3","3","3","3","3","3"],"ospf_ospf_lsa_router":true,"ospf_ospf_lsa_id":["124.0.0.7","177.177.177.0","24.0.0.1","24.0.0.4","172.16.24.1","172.16.24.4","192.168.100.4","192.168.100.16","192.168.100.20","192.168.100.24","192.168.100.28","192.168.100.64","192.168.100.68","192.168.100.72","192.168.100.76"],"ospf_ospf_advrouter":["124.0.0.7","124.0.0.7","124.0.0.7","124.0.0.7","124.0.0.7","124.0.0.7","124.0.0.7","124.0.0.7","124.0.0.7","124.0.0.7","124.0.0.7","124.0.0.7","124.0.0.7","124.0.0.7","124.0.0.7","124.0.0.7","124.0.0.7"],"ospf_ospf_lsa_seqnum":["0x8000029c","0x800000b9","0x800000d1","0x800001e3","0x80000266","0x80000266","0x80000266","0x80000266","0x80000266","0x80000266","0x80000266","0x80000266","0x80000266","0x80000266","0x80000266","0x80000266","0x80000266"],"ospf_ospf_lsa_chksum":["0x0000267e","0x00002dcd","0x0000d584","0x0000279c","0x000055d8","0x0000d460","0x0000ff71","0x00007ff8","0x00005227","0x0000d993","0x0000b3b5","0x00008bd9","0x000061ff","0x0000f943","0x0000d167","0x0000a98b","0x000083ad"],"ospf_ospf_lsa_length":["108","204","28","28","28","28","28","28","28","28","28","28","28","28","28","28","28"],"ospf_ospf_v2_router_lsa_flags":"0x00000003","ospf_ospf_v2_router_lsa_flags_h":false,"ospf_ospf_v2_router_lsa_flags_n":false,"ospf_ospf_v2_router_lsa_flags_w":false,"ospf_ospf_v2_router_lsa_flags_v":false,"ospf_ospf_v2_router_lsa_flags_e":true,"ospf_ospf_v2_router_lsa_flags_b":true,"ospf_ospf_lsa_number_of_links":"7","ospf_ospf_lsa_router_linkid":["124.0.0.7","172.16.24.7","24.0.0.174","175.175.175.0","192.168.100.160","12.0.0.18","192.168.102.0"],"ospf_ospf_lsa_router_linkdata":["255.255.255.255","255.255.255.255","175.175.175.1","255.255.255.252","255.255.255.252","192.168.102.2","255.255.255.252"],"ospf_ospf_lsa_router_linktype":["3","3","1","3","3","1","3"],"ospf_ospf_lsa_router_nummetrics":["0","0","0","0","0","0","0"],"ospf_ospf_lsa_router_metric0":["1","1","65535","65535","10","10","10"],"ospf_ospf_lsa_opaque":[true,true],"ospf_ospf_lsid_opaque_type":["1","1"],"ospf_ospf_lsid_te_lsa_reserved":["0","0"],"ospf_ospf_lsid_te_lsa_instance":["7","0"],"ospf_ospf_tlv_type":["2","1","2","3","4","5","6","7","8","9","32770","26","32771","1"],"ospf_ospf_tlv_length":["180","1","4","4","4","4","4","4","32","4","4","32","32","4"],"ospf_ospf_mpls_linktype":"1","ospf_ospf_mpls_linkid":"24.0.0.174","ospf_ospf_mpls_local_addr":"175.175.175.1","ospf_ospf_mpls_remote_addr":"175.175.175.2","ospf_ospf_mpls_te_metric":"65535","ospf_ospf_mpls_link_max_bw":["12500","0"],"ospf_ospf_mpls_pri":["0","0","0","0","0","0","0","0"],"ospf_ospf_mpls_linkcolor":"0x00000000","ospf_ospf_tlv_value":["00:00:ff:ff","00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00","00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00"],"ospf_ospf_lsa_mpls":[true,true],"ospf_ospf_mpls_routerid":"124.0.0.7","ospf_ospf_lsa_summary":[true,true,true,true,true,true,true,true,true,true,true,true,true,true],"ospf_ospf_lsa_asbr_netmask":["255.255.255.252","255.255.255.255","255.255.255.255","255.255.255.255","255.255.255.255","255.255.255.252","255.255.255.252","255.255.255.252","255.255.255.252","255.255.255.252","255.255.255.252","255.255.255.252","255.255.255.252","255.255.255.252"],"ospf_ospf_lsa_tos":["0","0","0","0","0","0","0","0","0","0","0","0","0","0"],"ospf_ospf_metric":["65535","131081","131071","131081","131071","131080","131080","65545","65545","131080","65545","65545","65545","10"]}}}') }
	    	it "clone 1 event type 3" do
	            events = [event]
	            subject.filter(event) {|e| events << e }
	    	end
        end

    end
end
